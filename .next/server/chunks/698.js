exports.id=698,exports.ids=[698],exports.modules={13198:(e,r,t)=>{let i={"4ca3e45e59d17eb24834057aa663cd58822f0362":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.rejectJoinRequest),"64819fdbf6747c9de70c4f6c789726e25ed33dab":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.getAllStations),"7718239856a5ecd6b6dd9302e4f387114b4eed56":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.acceptJoinRequest),"935a02ff5ad3f32514a031e75fad6c1a300ce60f":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.createStationAndBecomeAdmin),"952f7879cdccaeee0d550ce745157068cc57c2fa":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.inviteUserByEmail),cb7bd06c1d01ccb171f3a399726de42085eec918:()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.requestToJoinStation),"224786e73ae99791ee2081514241c01b03d7e1f2":()=>Promise.resolve().then(t.bind(t,83128)).then(e=>e.login),"2c667f50d9672450ffb9c7cc219224fdfd19874c":()=>Promise.resolve().then(t.bind(t,83128)).then(e=>e.logout),"7aa99930817149a187f1a871bbaf702dea9ea495":()=>Promise.resolve().then(t.bind(t,83128)).then(e=>e.signup)};async function a(e,...r){return(await i[e]()).apply(null,r)}e.exports={"4ca3e45e59d17eb24834057aa663cd58822f0362":a.bind(null,"4ca3e45e59d17eb24834057aa663cd58822f0362"),"64819fdbf6747c9de70c4f6c789726e25ed33dab":a.bind(null,"64819fdbf6747c9de70c4f6c789726e25ed33dab"),"7718239856a5ecd6b6dd9302e4f387114b4eed56":a.bind(null,"7718239856a5ecd6b6dd9302e4f387114b4eed56"),"935a02ff5ad3f32514a031e75fad6c1a300ce60f":a.bind(null,"935a02ff5ad3f32514a031e75fad6c1a300ce60f"),"952f7879cdccaeee0d550ce745157068cc57c2fa":a.bind(null,"952f7879cdccaeee0d550ce745157068cc57c2fa"),cb7bd06c1d01ccb171f3a399726de42085eec918:a.bind(null,"cb7bd06c1d01ccb171f3a399726de42085eec918"),"224786e73ae99791ee2081514241c01b03d7e1f2":a.bind(null,"224786e73ae99791ee2081514241c01b03d7e1f2"),"2c667f50d9672450ffb9c7cc219224fdfd19874c":a.bind(null,"2c667f50d9672450ffb9c7cc219224fdfd19874c"),"7aa99930817149a187f1a871bbaf702dea9ea495":a.bind(null,"7aa99930817149a187f1a871bbaf702dea9ea495")}},75782:(e,r,t)=>{"use strict";t.d(r,{RM:()=>o,SC:()=>c,iA:()=>s,pj:()=>f,ss:()=>l,xD:()=>d});var i=t(19510),a=t(71159),n=t(40644);let s=a.forwardRef(({className:e,...r},t)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",e),...r})}));s.displayName="Table";let d=a.forwardRef(({className:e,...r},t)=>i.jsx("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",e),...r}));d.displayName="TableHeader";let o=a.forwardRef(({className:e,...r},t)=>i.jsx("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...r}));o.displayName="TableBody",a.forwardRef(({className:e,...r},t)=>i.jsx("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let c=a.forwardRef(({className:e,...r},t)=>i.jsx("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));c.displayName="TableRow";let l=a.forwardRef(({className:e,...r},t)=>i.jsx("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));l.displayName="TableHead";let f=a.forwardRef(({className:e,...r},t)=>i.jsx("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));f.displayName="TableCell",a.forwardRef(({className:e,...r},t)=>i.jsx("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption"},66561:(e,r,t)=>{"use strict";t.r(r),t.d(r,{acceptJoinRequest:()=>l,createStationAndBecomeAdmin:()=>d,getAllStations:()=>c,inviteUserByEmail:()=>u,rejectJoinRequest:()=>f,requestToJoinStation:()=>o});var i=t(24330);t(60166);var a=t(65655),n=t(57708),s=t(58585);async function d(e){let r;let t=(0,a.e)(),{data:{user:i},error:d}=await t.auth.getUser();if(console.log("Auth check:",{user:i?.id,email:i?.email,error:d}),!i)return(0,s.redirect)("/onboarding?error=Sie sind nicht angemeldet. Bitte melden Sie sich an.");let o=e.get("stationName"),c=e.get("organizationName");if(console.log("Creating station:",{stationName:o,organizationName:c,userId:i.id}),!o||""===o.trim())return(0,s.redirect)("/onboarding?error=Wachen-Name ist erforderlich.");let{data:l}=await t.from("memberships").select("id").eq("user_id",i.id).limit(1).single();if(l)return(0,s.redirect)("/app");if(c&&""!==c.trim()){let{data:e,error:i}=await t.from("organizations").insert({name:c.trim()}).select("id").single();if(i||!e){console.error("Error creating organization:",i);let e=i?`${i.message} (Code: ${i.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Organisation: ${e}`)}`)}r=e.id}else{let{data:e}=await t.from("organizations").select("id").limit(1).single();if(e)r=e.id;else{let{data:e,error:i}=await t.from("organizations").insert({name:"Standard Organisation"}).select("id").single();if(i||!e){console.error("Error creating default organization:",i);let e=i?`${i.message} (Code: ${i.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Standard-Organisation: ${e}`)}`)}r=e.id}}let{data:f,error:u}=await t.from("stations").insert({org_id:r,name:o.trim()}).select("id").single();if(u||!f){console.error("Error creating station:",u);let e=u?`${u.message} (Code: ${u.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Wache: ${e}`)}`)}console.log("Attempting to create membership:",{user_id:i.id,station_id:f.id,role:"ADMIN"});let{data:m,error:b}=await t.from("memberships").insert({user_id:i.id,station_id:f.id,role:"ADMIN"}).select();if(console.log("Membership result:",{data:m,error:b}),b){console.error("Error creating membership:",b);let e=b?`${b.message} (Code: ${b.code}, Details: ${b.details})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Zuweisen der Admin-Rolle: ${e}`)}`)}(0,n.revalidatePath)("/app"),(0,s.redirect)("/app")}async function o(e){let r=(0,a.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let i=e.get("stationId");if(!i)return(0,s.redirect)("/onboarding?error=Keine Wache ausgew\xe4hlt.");let{data:n}=await r.from("memberships").select("id, station_id").eq("user_id",t.id);if(n&&n.length>0)return(0,s.redirect)("/app");let{data:d,error:o}=await r.from("stations").select("id, name").eq("id",i).single();if(o||!d)return console.error("Station lookup error:",o),(0,s.redirect)("/onboarding?error=Wache nicht gefunden.");let{data:c}=await r.from("join_requests").select("id, status").eq("user_id",t.id).eq("station_id",i).single();if(c){if("PENDING"===c.status)return(0,s.redirect)("/onboarding?success=Sie haben bereits eine ausstehende Anfrage f\xfcr diese Wache.");if("REJECTED"===c.status)return(0,s.redirect)("/onboarding?error=Ihre Anfrage f\xfcr diese Wache wurde abgelehnt. Bitte kontaktieren Sie einen Administrator.")}let{data:l,error:f}=await r.from("join_requests").insert({user_id:t.id,station_id:i,status:"PENDING"}).select();if(f)return(console.error("Error creating join request:",f),console.error("Error details:",{code:f.code,message:f.message,details:f.details,hint:f.hint}),"23505"===f.code)?(0,s.redirect)("/onboarding?success=Sie haben bereits eine Anfrage f\xfcr diese Wache gestellt."):(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Senden der Beitrittsanfrage: ${f.message}`)}`);console.log("Join request created successfully:",l),(0,s.redirect)("/onboarding?success=Beitrittsanfrage gesendet! Warten Sie auf die Best\xe4tigung eines Administrators.")}async function c(){let e=(0,a.e)(),{data:r,error:t}=await e.from("stations").select("id, name, org:organizations(name)").order("name",{ascending:!0});return t?(console.error("Error fetching stations:",t),[]):r||[]}async function l(e){let r=(0,a.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let i=e.get("requestId"),d=e.get("divisionIds"),o=e.get("role");if(!i||!o)return(0,s.redirect)("/app/join-requests?error=Fehlende Parameter.");let c=d&&""!==d.trim()?d.split(",").filter(e=>""!==e.trim()):[],{data:l,error:f}=await r.from("join_requests").select("*, station:stations(id)").eq("id",i).single();if(f||!l)return(0,s.redirect)("/app/join-requests?error=Beitrittsanfrage nicht gefunden.");let{data:u}=await r.from("memberships").select("role").eq("user_id",t.id).eq("station_id",l.station.id).single();if(!u||"ADMIN"!==u.role)return(0,s.redirect)("/app/join-requests?error=Keine Berechtigung.");let m={user_id:l.user_id,station_id:l.station_id,role:o};"EDITOR"===o&&c.length>0&&(m.division_ids=c,m.division_id=c[0]),console.log("Creating membership with data:",m);let{data:b,error:g}=await r.from("memberships").insert(m).select();if(g)return console.error("Error creating membership:",g),console.error("Error details:",{code:g.code,message:g.message,details:g.details,hint:g.hint}),(0,s.redirect)(`/app/join-requests?error=${encodeURIComponent("Fehler beim Erstellen der Mitgliedschaft: "+g.message)}`);console.log("Membership created successfully:",b);let{error:h}=await r.from("join_requests").update({status:"APPROVED"}).eq("id",i);h&&console.error("Error updating join request:",h),(0,n.revalidatePath)("/app/join-requests"),(0,n.revalidatePath)("/app/users"),(0,s.redirect)("/app/join-requests?success=Beitrittsanfrage akzeptiert.")}async function f(e){let r=(0,a.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let i=e.get("requestId");if(!i)return(0,s.redirect)("/admin?error=Fehlende Parameter.");let{data:d,error:o}=await r.from("join_requests").select("*, station:stations(id)").eq("id",i).single();if(o||!d)return(0,s.redirect)("/admin?error=Beitrittsanfrage nicht gefunden.");let{data:c}=await r.from("memberships").select("role").eq("user_id",t.id).eq("station_id",d.station.id).single();if(!c||"ADMIN"!==c.role)return(0,s.redirect)("/admin?error=Keine Berechtigung.");let{error:l}=await r.from("join_requests").update({status:"REJECTED"}).eq("id",i);if(l)return console.error("Error updating join request:",l),(0,s.redirect)("/app/join-requests?error=Fehler beim Ablehnen der Anfrage.");(0,n.revalidatePath)("/app/join-requests"),(0,s.redirect)("/app/join-requests?success=Beitrittsanfrage abgelehnt.")}async function u(e){let r=(0,a.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let i=e.get("email"),d=e.get("role"),o=e.get("divisionIds");if(!i||!d)return(0,s.redirect)("/app/users?error=Fehlende Parameter.");let c=o&&""!==o.trim()?o.split(",").filter(e=>""!==e.trim()):[],{data:l}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!l||"ADMIN"!==l.role)return(0,s.redirect)("/app/users?error=Keine Berechtigung.");let{data:f}=await r.from("users_profile").select("id").eq("email",i.toLowerCase().trim()).single();if(!f)return(0,s.redirect)("/app/users?error=Kein Benutzer mit dieser E-Mail-Adresse gefunden. Der Benutzer muss sich zuerst registrieren.");let{data:u}=await r.from("memberships").select("id").eq("user_id",f.id).eq("station_id",l.station_id).single();if(u)return(0,s.redirect)("/app/users?error=Benutzer ist bereits Mitglied dieser Wache.");let m={user_id:f.id,station_id:l.station_id,role:d};"EDITOR"===d&&c.length>0&&(m.division_ids=c,m.division_id=c[0]);let{error:b}=await r.from("memberships").insert(m);if(b)return console.error("Error creating membership:",b),(0,s.redirect)("/app/users?error=Fehler beim Hinzuf\xfcgen des Benutzers.");(0,n.revalidatePath)("/app/users"),(0,s.redirect)("/app/users?success=Benutzer erfolgreich hinzugef\xfcgt.")}(0,t(40618).h)([d,o,c,l,f,u]),(0,i.j)("935a02ff5ad3f32514a031e75fad6c1a300ce60f",d),(0,i.j)("cb7bd06c1d01ccb171f3a399726de42085eec918",o),(0,i.j)("64819fdbf6747c9de70c4f6c789726e25ed33dab",c),(0,i.j)("7718239856a5ecd6b6dd9302e4f387114b4eed56",l),(0,i.j)("4ca3e45e59d17eb24834057aa663cd58822f0362",f),(0,i.j)("952f7879cdccaeee0d550ce745157068cc57c2fa",u)}};