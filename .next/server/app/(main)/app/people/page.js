(()=>{var e={};e.id=654,e.ids=[654],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},49065:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>s.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>h,tree:()=>o}),t(2856),t(88834),t(41611),t(35866),t(32029);var a=t(23191),i=t(88716),n=t(37922),s=t.n(n),l=t(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(r,d);let o=["",{children:["(main)",{children:["app",{children:["people",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2856)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/people/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,88834)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,41611)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,32029)),"/Users/kamakaku/_desiqn/__wachboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/people/page.tsx"],p="/(main)/app/people/page",u={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/app/people/page",pathname:"/app/people",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},11129:(e,r,t)=>{let a={"3c23ca4f3b1355dcffd51127db94351e84048094":()=>Promise.resolve().then(t.bind(t,58579)).then(e=>e.togglePersonActive),"51ac06d73d972e6d089fb92838fafb0e3eb4f35a":()=>Promise.resolve().then(t.bind(t,58579)).then(e=>e.deletePerson),b1897e0005cd0d3c17d944a4cd8116b179a1fc62:()=>Promise.resolve().then(t.bind(t,58579)).then(e=>e.updatePerson),ba721a7a72a294373b964663b4806a847fb58b81:()=>Promise.resolve().then(t.bind(t,58579)).then(e=>e.createPerson)};async function i(e,...r){return(await a[e]()).apply(null,r)}e.exports={"3c23ca4f3b1355dcffd51127db94351e84048094":i.bind(null,"3c23ca4f3b1355dcffd51127db94351e84048094"),"51ac06d73d972e6d089fb92838fafb0e3eb4f35a":i.bind(null,"51ac06d73d972e6d089fb92838fafb0e3eb4f35a"),b1897e0005cd0d3c17d944a4cd8116b179a1fc62:i.bind(null,"b1897e0005cd0d3c17d944a4cd8116b179a1fc62"),ba721a7a72a294373b964663b4806a847fb58b81:i.bind(null,"ba721a7a72a294373b964663b4806a847fb58b81")}},16254:(e,r,t)=>{Promise.resolve().then(t.bind(t,1058))},15919:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(62881).Z)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},15601:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(62881).Z)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},87815:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(62881).Z)("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]])},1058:(e,r,t)=>{"use strict";t.d(r,{PeoplePoolsManager:()=>k});var a=t(10326),i=t(50384),n=t(3594),s=t(38443),l=t(41156),d=t(17577),o=t(91664),c=t(24118),p=t(10143),u=t(41190),h=t(44794),m=t(15919);t(15424);var f=t(46242),g=(0,f.$)("b1897e0005cd0d3c17d944a4cd8116b179a1fc62"),x=(0,f.$)("ba721a7a72a294373b964663b4806a847fb58b81"),b=(0,f.$)("3c23ca4f3b1355dcffd51127db94351e84048094"),j=(0,f.$)("51ac06d73d972e6d089fb92838fafb0e3eb4f35a");function v({person:e,divisions:r}){let[t,i]=(0,d.useState)(!1);return(0,a.jsxs)(c.Dialog,{open:t,onOpenChange:i,children:[(0,a.jsxs)(p.DropdownMenu,{children:[a.jsx(p.DropdownMenuTrigger,{asChild:!0,children:a.jsx(o.z,{variant:"ghost",size:"sm",children:a.jsx(m.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(p.DropdownMenuContent,{align:"end",children:[a.jsx(p.DropdownMenuItem,{onSelect:r=>{r.preventDefault();let t=document.getElementById(`toggle-person-${e.id}`);t?.requestSubmit()},children:e.active?"Deaktivieren":"Aktivieren"}),a.jsx(c.DialogTrigger,{asChild:!0,children:a.jsx(p.DropdownMenuItem,{onSelect:e=>e.preventDefault(),children:"Bearbeiten"})}),a.jsx(p.DropdownMenuItem,{className:"text-destructive",onSelect:r=>{r.preventDefault();let t=document.getElementById(`delete-person-${e.id}`);t?.requestSubmit()},children:"L\xf6schen"})]})]}),(0,a.jsxs)(c.DialogContent,{className:"max-w-3xl",children:[(0,a.jsxs)(c.DialogHeader,{children:[a.jsx(c.DialogTitle,{children:"Person bearbeiten"}),a.jsx(c.DialogDescription,{children:"Aktualisieren Sie Name, Rang und Qualifikationen."})]}),(0,a.jsxs)("form",{action:g,className:"space-y-4",children:[a.jsx("input",{type:"hidden",name:"personId",value:e.id}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`edit-name-${e.id}`,children:"Name *"}),a.jsx(u.I,{id:`edit-name-${e.id}`,name:"name",defaultValue:e.name,required:!0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`edit-rank-${e.id}`,children:"Rang"}),a.jsx(u.I,{id:`edit-rank-${e.id}`,name:"rank",defaultValue:e.rank??""})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`edit-tags-${e.id}`,children:"Qualifikationen"}),a.jsx(u.I,{id:`edit-tags-${e.id}`,name:"tags",defaultValue:e.tags?.join(", ")??""})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`edit-divisions-${e.id}`,children:"Wachabteilungen (optional)"}),a.jsx("div",{className:"border rounded-md p-3 space-y-2",children:r&&r.length>0?r.map(r=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:`edit-division-${e.id}-${r.id}`,name:"division_ids",value:r.id,defaultChecked:e.division_ids?.includes(r.id),className:"h-4 w-4 rounded border-gray-300"}),(0,a.jsxs)("label",{htmlFor:`edit-division-${e.id}-${r.id}`,className:"text-sm cursor-pointer flex items-center gap-2",children:[r.color&&a.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),r.name]})]},r.id)):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Keine Wachabteilungen verf\xfcgbar"})}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Leer lassen = f\xfcr alle Wachabteilungen verf\xfcgbar"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`edit-photo-url-${e.id}`,children:"Foto-URL"}),a.jsx(u.I,{id:`edit-photo-url-${e.id}`,name:"photo_url",defaultValue:e.photo_url??""}),a.jsx(o.z,{variant:"outline",type:"button",asChild:!0,children:(0,a.jsxs)("label",{children:["Neues Foto hochladen",a.jsx("input",{type:"file",name:"photo_file",accept:"image/*",className:"hidden"})]})})]}),a.jsx(c.DialogFooter,{children:a.jsx(o.z,{type:"submit",children:"Speichern"})})]})]}),(0,a.jsxs)("form",{id:`toggle-person-${e.id}`,action:b,className:"hidden",children:[a.jsx("input",{type:"hidden",name:"personId",value:e.id}),a.jsx("input",{type:"hidden",name:"currentStatus",value:e.active?"true":"false"})]}),a.jsx("form",{id:`delete-person-${e.id}`,action:j,className:"hidden",children:a.jsx("input",{type:"hidden",name:"personId",value:e.id})})]})}var y=t(29752),N=t(24061),_=t(87815),w=t(15601);function k({people:e,divisions:r}){let t=e.filter(e=>!e.person_type||"MITARBEITER"===e.person_type),d=e.filter(e=>"NOTARZT"===e.person_type),p=e.filter(e=>"FUEHRUNGSDIENST"===e.person_type),m=(e,t)=>(0,a.jsxs)(c.Dialog,{children:[a.jsx(c.DialogTrigger,{asChild:!0,children:a.jsx(o.z,{children:"Neue Person hinzuf\xfcgen"})}),(0,a.jsxs)(c.DialogContent,{className:"max-w-3xl",children:[(0,a.jsxs)(c.DialogHeader,{children:[a.jsx(c.DialogTitle,{children:t}),a.jsx(c.DialogDescription,{children:"Name, Rang, Qualifikationen und Foto erfassen"})]}),(0,a.jsxs)("form",{action:x,className:"space-y-4",children:[a.jsx("input",{type:"hidden",name:"person_type",value:e}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`create-name-${e}`,children:"Name *"}),a.jsx(u.I,{id:`create-name-${e}`,name:"name",placeholder:"z. B. Mustermann, Max",required:!0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`create-rank-${e}`,children:"Rang"}),a.jsx(u.I,{id:`create-rank-${e}`,name:"rank",placeholder:"z. B. HBM, OBM, BM"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`create-tags-${e}`,children:"Qualifikationen"}),a.jsx(u.I,{id:`create-tags-${e}`,name:"tags",placeholder:"GF, MA, AT"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Kommagetrennt eingeben"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`create-divisions-${e}`,children:"Wachabteilungen (optional)"}),a.jsx("div",{className:"border rounded-md p-3 space-y-2",children:r&&r.length>0?r.map(r=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:`division-${e}-${r.id}`,name:"division_ids",value:r.id,className:"h-4 w-4 rounded border-gray-300"}),(0,a.jsxs)("label",{htmlFor:`division-${e}-${r.id}`,className:"text-sm cursor-pointer flex items-center gap-2",children:[r.color&&a.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),r.name]})]},r.id)):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Keine Wachabteilungen verf\xfcgbar"})}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Leer lassen = f\xfcr alle Wachabteilungen verf\xfcgbar"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(h.Label,{htmlFor:`create-photo_url-${e}`,children:"Foto-URL (optional)"}),a.jsx(u.I,{id:`create-photo_url-${e}`,name:"photo_url",type:"url",placeholder:"https://..."}),a.jsx(o.z,{variant:"outline",type:"button",asChild:!0,children:(0,a.jsxs)("label",{children:["Foto hochladen",a.jsx("input",{type:"file",name:"photo_file",accept:"image/*",className:"hidden"})]})})]}),a.jsx(c.DialogFooter,{children:a.jsx(o.z,{type:"submit",children:"Person hinzuf\xfcgen"})})]})]})]}),f=e=>e&&e.length>0?(0,a.jsxs)(l.iA,{children:[a.jsx(l.xD,{children:(0,a.jsxs)(l.SC,{children:[a.jsx(l.ss,{children:"Avatar"}),a.jsx(l.ss,{children:"Name"}),a.jsx(l.ss,{children:"Rang"}),a.jsx(l.ss,{children:"Qualifikationen"}),a.jsx(l.ss,{children:"Wachabteilungen"}),a.jsx(l.ss,{children:"Status"}),a.jsx(l.ss,{className:"text-right",children:"Aktionen"})]})}),a.jsx(l.RM,{children:e.map(e=>(0,a.jsxs)(l.SC,{children:[a.jsx(l.pj,{children:a.jsx(n.q,{src:e.photo_url??void 0,name:e.name??void 0,size:36})}),(0,a.jsxs)(l.pj,{children:[a.jsx("p",{className:"font-medium",children:e.name}),e.email&&a.jsx("p",{className:"text-sm text-muted-foreground",children:e.email})]}),a.jsx(l.pj,{children:e.rank||"-"}),a.jsx(l.pj,{children:e.tags&&e.tags.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:e.tags.map((e,r)=>a.jsx(s.C,{variant:"outline",children:e},r))}):"-"}),a.jsx(l.pj,{children:e.division_ids&&e.division_ids.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:e.division_ids.map(e=>{let t=r.find(r=>r.id===e);return t?(0,a.jsxs)(s.C,{variant:"secondary",className:"flex items-center gap-1",children:[t.color&&a.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),t.name]},e):null})}):a.jsx("span",{className:"text-sm text-muted-foreground",children:"Alle"})}),a.jsx(l.pj,{children:a.jsx(s.C,{variant:e.active?"default":"secondary",children:e.active?"Aktiv":"Inaktiv"})}),a.jsx(l.pj,{children:a.jsx(v,{person:e,divisions:r})})]},e.id))})]}):a.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Keine Personen vorhanden. Erstellen Sie den ersten Eintrag."});return(0,a.jsxs)(i.Tabs,{defaultValue:"mitarbeiter",className:"w-full",children:[(0,a.jsxs)(i.TabsList,{className:"grid w-full grid-cols-3",children:[(0,a.jsxs)(i.TabsTrigger,{value:"mitarbeiter",children:[a.jsx(N.Z,{className:"h-4 w-4 mr-2"}),"Mitarbeiter (",t.length,")"]}),(0,a.jsxs)(i.TabsTrigger,{value:"notarzt",children:[a.jsx(_.Z,{className:"h-4 w-4 mr-2"}),"Notarzt-Pool (",d.length,")"]}),(0,a.jsxs)(i.TabsTrigger,{value:"fuehrungsdienst",children:[a.jsx(w.Z,{className:"h-4 w-4 mr-2"}),"F\xfchrungsdienst-Pool (",p.length,")"]})]}),a.jsx(i.TabsContent,{value:"mitarbeiter",children:(0,a.jsxs)(y.Zb,{children:[a.jsx(y.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx(y.ll,{children:"Mitarbeiter"}),(0,a.jsxs)(y.SZ,{children:["Regul\xe4re Mitarbeiter (",t.length,")"]})]}),m("MITARBEITER","Neuen Mitarbeiter hinzuf\xfcgen")]})}),a.jsx(y.aY,{children:f(t)})]})}),a.jsx(i.TabsContent,{value:"notarzt",children:(0,a.jsxs)(y.Zb,{children:[a.jsx(y.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(y.ll,{className:"flex items-center gap-2",children:[a.jsx(_.Z,{className:"h-5 w-5 text-red-600"}),"Notarzt-Pool"]}),(0,a.jsxs)(y.SZ,{children:["Not\xe4rzte, die im Dienstplan eingesetzt werden k\xf6nnen (",d.length,")"]})]}),m("NOTARZT","Neuen Notarzt hinzuf\xfcgen")]})}),a.jsx(y.aY,{children:f(d)})]})}),a.jsx(i.TabsContent,{value:"fuehrungsdienst",children:(0,a.jsxs)(y.Zb,{children:[a.jsx(y.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(y.ll,{className:"flex items-center gap-2",children:[a.jsx(w.Z,{className:"h-5 w-5 text-blue-600"}),"F\xfchrungsdienst-Pool"]}),(0,a.jsxs)(y.SZ,{children:["F\xfchrungskr\xe4fte, die im Dienstplan eingesetzt werden k\xf6nnen (",p.length,")"]})]}),m("FUEHRUNGSDIENST","Neue F\xfchrungskraft hinzuf\xfcgen")]})}),a.jsx(y.aY,{children:f(p)})]})})]})}},3594:(e,r,t)=>{"use strict";t.d(r,{q:()=>s});var a=t(10326),i=t(46226),n=t(51223);function s({src:e,name:r,size:t=36,className:s}){let l=r?r.split(" ").filter(Boolean).map(e=>e[0]).slice(0,2).join("").toUpperCase():"";return a.jsx("div",{className:(0,n.cn)("relative overflow-hidden rounded-full bg-muted text-muted-foreground/70 flex items-center justify-center border border-border flex-shrink-0",s),style:{width:t,height:t},children:e?a.jsx(i.default,{src:e,alt:r??"Avatar",width:t,height:t,className:"object-cover w-full h-full",unoptimized:!0}):a.jsx("span",{style:{fontSize:.4*t},className:"font-semibold",children:l||"?"})})}},38443:(e,r,t)=>{"use strict";t.d(r,{C:()=>l});var a=t(10326);t(17577);var i=t(79360),n=t(51223);let s=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,...t}){return a.jsx("div",{className:(0,n.cn)(s({variant:r}),e),...t})}},50384:(e,r,t)=>{"use strict";t.d(r,{Tabs:()=>l,TabsContent:()=>c,TabsList:()=>d,TabsTrigger:()=>o});var a=t(10326),i=t(17577),n=t(28407),s=t(51223);let l=n.fC,d=i.forwardRef(({className:e,...r},t)=>a.jsx(n.aV,{ref:t,className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...r}));d.displayName=n.aV.displayName;let o=i.forwardRef(({className:e,...r},t)=>a.jsx(n.xz,{ref:t,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r}));o.displayName=n.xz.displayName;let c=i.forwardRef(({className:e,...r},t)=>a.jsx(n.VY,{ref:t,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r}));c.displayName=n.VY.displayName},2856:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>o});var a=t(19510),i=t(65655),n=t(58585),s=t(93804),l=t(63956);let d=(0,t(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/admin/people-pools-manager.tsx#PeoplePoolsManager`);async function o({searchParams:e}){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();t||(0,n.redirect)("/login");let{data:o}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!o||!["ADMIN","EDITOR"].includes(o.role))return a.jsx("div",{className:"py-8 px-6",children:(0,a.jsxs)(s.Zb,{className:"border-destructive",children:[a.jsx(s.Ol,{children:a.jsx(s.ll,{children:"Zugriff verweigert"})}),a.jsx(s.aY,{children:a.jsx("p",{children:"Sie ben\xf6tigen Editor- oder Administrator-Rechte."})})]})});let{data:c}=await r.from("people").select("*").eq("station_id",o.station_id).order("name",{ascending:!0}),{data:p}=await r.from("divisions").select("id, name, color").eq("station_id",o.station_id).order("name",{ascending:!0});return(0,a.jsxs)("div",{className:"py-8 px-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Personal"}),a.jsx("p",{className:"text-muted-foreground",children:"Verwalten Sie Mitarbeiter, Not\xe4rzte und F\xfchrungsdienst getrennt"})]}),e.error&&(0,a.jsxs)(l.bZ,{variant:"destructive",className:"mb-6",children:[a.jsx(l.Cd,{children:"Fehler"}),a.jsx(l.X,{children:e.error})]}),e.success&&(0,a.jsxs)(l.bZ,{className:"mb-6 border-green-500",children:[a.jsx(l.Cd,{children:"Erfolg"}),a.jsx(l.X,{children:e.success})]}),a.jsx(d,{people:c||[],divisions:p||[]})]})}},63956:(e,r,t)=>{"use strict";t.d(r,{Cd:()=>o,X:()=>c,bZ:()=>d});var a=t(19510),i=t(71159),n=t(46145),s=t(40644);let l=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=i.forwardRef(({className:e,variant:r,...t},i)=>a.jsx("div",{ref:i,role:"alert",className:(0,s.cn)(l({variant:r}),e),...t}));d.displayName="Alert";let o=i.forwardRef(({className:e,...r},t)=>a.jsx("h5",{ref:t,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...r}));o.displayName="AlertTitle";let c=i.forwardRef(({className:e,...r},t)=>a.jsx("div",{ref:t,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...r}));c.displayName="AlertDescription"},58579:(e,r,t)=>{"use strict";t.r(r),t.d(r,{createPerson:()=>u,deletePerson:()=>m,togglePersonActive:()=>h,updatePerson:()=>f});var a=t(27745);t(26461);var i=t(71870),n=t(30207),s=t(74739),l=t(98406);let d=function(){let e="https://ghjfyjximndlrstwridq.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Supabase URL or service role key missing");return(0,l.eI)(e,r)}();async function o(e,r,t){let{error:a}=await d.storage.from(e).upload(r,t,{cacheControl:"3600",upsert:!0});if(a)throw a;let{data:i}=d.storage.from(e).getPublicUrl(r);return i.publicUrl}async function c(e,r){let t=function(e,r){let t=e?.lastIndexOf(".")??-1;if(t>0)return e.slice(t+1);let[,a]=r.split("/");return a||"bin"}(e.name,e.type);return o("people-photos",`people/${r}/${crypto.randomUUID()}.${t}`,e)}async function p(e,r,t){if(!e)return null;try{return await c(e,r)}catch(e){console.error("Error uploading person photo:",e),(0,s.redirect)(`${t}?error=${encodeURIComponent("Fehler beim Hochladen des Fotos.")}`)}}async function u(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("name"),l=e.get("rank"),d=e.get("tags"),o=e.get("photo_url"),c=e.get("photo_file"),u=e.get("person_type"),h=e.getAll("division_ids");if(!a||""===a.trim())return(0,s.redirect)("/app/people?error=Name ist erforderlich.");let m=d?d.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],f=h.filter(e=>e&&""!==e.trim()),{data:g}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!g||!["ADMIN","EDITOR"].includes(g.role))return(0,s.redirect)("/app/people?error=Keine Berechtigung.");let x=await p(c,g.station_id,"/app/people")??o??null,{error:b}=await r.from("people").insert({station_id:g.station_id,name:a.trim(),rank:l?l.trim():null,tags:m.length>0?m:null,photo_url:x,person_type:u||"MITARBEITER",division_ids:f.length>0?f:null,active:!0});if(b)return console.error("Error creating person:",b),(0,s.redirect)(`/app/people?error=${encodeURIComponent("Fehler beim Erstellen der Person.")}`);(0,n.revalidatePath)("/app/people"),(0,s.redirect)("/app/people?success=Person erfolgreich hinzugef\xfcgt.")}async function h(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("personId"),l="true"===e.get("currentStatus");if(!a)return(0,s.redirect)("/app/people?error=Person nicht gefunden.");let{data:d}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!d||!["ADMIN","EDITOR"].includes(d.role))return(0,s.redirect)("/app/people?error=Keine Berechtigung.");let{data:o}=await r.from("people").select("station_id").eq("id",a).single();if(!o||o.station_id!==d.station_id)return(0,s.redirect)("/app/people?error=Person nicht gefunden.");let{error:c}=await r.from("people").update({active:!l}).eq("id",a);if(c)return console.error("Error updating person:",c),(0,s.redirect)(`/app/people?error=${encodeURIComponent("Fehler beim Aktualisieren der Person.")}`);(0,n.revalidatePath)("/app/people"),(0,s.redirect)("/app/people?success=Status erfolgreich ge\xe4ndert.")}async function m(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("personId");if(!a)return(0,s.redirect)("/app/people?error=Person nicht gefunden.");let{data:l}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!l||!["ADMIN","EDITOR"].includes(l.role))return(0,s.redirect)("/app/people?error=Keine Berechtigung.");let{data:d}=await r.from("people").select("station_id").eq("id",a).single();if(!d||d.station_id!==l.station_id)return(0,s.redirect)("/app/people?error=Person nicht gefunden.");let{error:o}=await r.from("people").delete().eq("id",a);if(o)return console.error("Error deleting person:",o),(0,s.redirect)(`/app/people?error=${encodeURIComponent("Fehler beim L\xf6schen der Person.")}`);(0,n.revalidatePath)("/app/people"),(0,s.redirect)("/app/people?success=Person erfolgreich gel\xf6scht.")}async function f(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("personId"),l=e.get("name")?.trim()??"",d=e.get("rank")?.trim()??"",o=e.get("tags")??"",c=e.get("photo_url")?.trim()??"",u=e.get("photo_file"),h=e.getAll("division_ids");if(!a||""===l)return(0,s.redirect)("/app/people?error=Name ist erforderlich.");let m=o?o.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],f=h.filter(e=>e&&""!==e.trim()),{data:g}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!g||!["ADMIN","EDITOR"].includes(g.role))return(0,s.redirect)("/app/people?error=Keine Berechtigung.");let{data:x}=await r.from("people").select("station_id").eq("id",a).single();if(!x||x.station_id!==g.station_id)return(0,s.redirect)("/app/people?error=Person nicht gefunden.");let b=await p(u,g.station_id,"/app/people")??c??null,{error:j}=await r.from("people").update({name:l,rank:d||null,tags:m.length>0?m:null,photo_url:b,division_ids:f.length>0?f:null}).eq("id",a);if(j)return console.error("Error updating person:",j),(0,s.redirect)(`/app/people?error=${encodeURIComponent("Fehler beim Aktualisieren der Person.")}`);(0,n.revalidatePath)("/app/people"),(0,s.redirect)("/app/people?success=Person erfolgreich aktualisiert.")}(0,t(85723).h)([u,h,m,f]),(0,a.j)("ba721a7a72a294373b964663b4806a847fb58b81",u),(0,a.j)("3c23ca4f3b1355dcffd51127db94351e84048094",h),(0,a.j)("51ac06d73d972e6d089fb92838fafb0e3eb4f35a",m),(0,a.j)("b1897e0005cd0d3c17d944a4cd8116b179a1fc62",f)},28407:(e,r,t)=>{"use strict";t.d(r,{VY:()=>$,aV:()=>D,fC:()=>C,xz:()=>T});var a=t(17577),i=t(82561),n=t(93095),s=t(15594),l=t(9815),d=t(77335),o=t(17124),c=t(52067),p=t(88957),u=t(10326),h="Tabs",[m,f]=(0,n.b)(h,[s.Pc]),g=(0,s.Pc)(),[x,b]=m(h),j=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:a,onValueChange:i,defaultValue:n,orientation:s="horizontal",dir:l,activationMode:m="automatic",...f}=e,g=(0,o.gm)(l),[b,j]=(0,c.T)({prop:a,onChange:i,defaultProp:n??"",caller:h});return(0,u.jsx)(x,{scope:t,baseId:(0,p.M)(),value:b,onValueChange:j,orientation:s,dir:g,activationMode:m,children:(0,u.jsx)(d.WV.div,{dir:g,"data-orientation":s,...f,ref:r})})});j.displayName=h;var v="TabsList",y=a.forwardRef((e,r)=>{let{__scopeTabs:t,loop:a=!0,...i}=e,n=b(v,t),l=g(t);return(0,u.jsx)(s.fC,{asChild:!0,...l,orientation:n.orientation,dir:n.dir,loop:a,children:(0,u.jsx)(d.WV.div,{role:"tablist","aria-orientation":n.orientation,...i,ref:r})})});y.displayName=v;var N="TabsTrigger",_=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:a,disabled:n=!1,...l}=e,o=b(N,t),c=g(t),p=P(o.baseId,a),h=I(o.baseId,a),m=a===o.value;return(0,u.jsx)(s.ck,{asChild:!0,...c,focusable:!n,active:m,children:(0,u.jsx)(d.WV.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":h,"data-state":m?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:p,...l,ref:r,onMouseDown:(0,i.Mj)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(a)}),onKeyDown:(0,i.Mj)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(a)}),onFocus:(0,i.Mj)(e.onFocus,()=>{let e="manual"!==o.activationMode;m||n||!e||o.onValueChange(a)})})})});_.displayName=N;var w="TabsContent",k=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:i,forceMount:n,children:s,...o}=e,c=b(w,t),p=P(c.baseId,i),h=I(c.baseId,i),m=i===c.value,f=a.useRef(m);return a.useEffect(()=>{let e=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,u.jsx)(l.z,{present:n||m,children:({present:t})=>(0,u.jsx)(d.WV.div,{"data-state":m?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":p,hidden:!t,id:h,tabIndex:0,...o,ref:r,style:{...e.style,animationDuration:f.current?"0s":void 0},children:t&&s})})});function P(e,r){return`${e}-trigger-${r}`}function I(e,r){return`${e}-content-${r}`}k.displayName=w;var C=j,D=y,T=_,$=k}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,374,702,582,559,369,4,744,226,52,863,384],()=>t(49065));module.exports=a})();