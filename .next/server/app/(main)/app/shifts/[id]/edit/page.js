"use strict";(()=>{var e={};e.id=183,e.ids=[183],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},74166:(e,i,s)=>{s.r(i),s.d(i,{GlobalError:()=>r.a,__next_app__:()=>h,originalPathname:()=>p,pages:()=>c,routeModule:()=>u,tree:()=>o}),s(8343),s(88834),s(41611),s(35866),s(32029);var t=s(23191),a=s(88716),n=s(37922),r=s.n(n),d=s(95231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);s.d(i,l);let o=["",{children:["(main)",{children:["app",{children:["shifts",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8343)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/shifts/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,88834)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,41611)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,32029)),"/Users/kamakaku/_desiqn/__wachboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/shifts/[id]/edit/page.tsx"],p="/(main)/app/shifts/[id]/edit/page",h={require:s,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/app/shifts/[id]/edit/page",pathname:"/app/shifts/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8343:(e,i,s)=>{s.r(i),s.d(i,{default:()=>x});var t=s(19510),a=s(65655),n=s(58585),r=s(57371),d=s(27039),l=s(93804),o=s(49922),c=s(40278),p=s(39755),h=s(36974),u=s(25544),m=s(36523);async function x({params:e,searchParams:i}){let s=(0,a.e)(),{data:{user:x}}=await s.auth.getUser();x||(0,n.redirect)("/login");let{data:g}=await s.from("memberships").select("station_id, role, division_ids").eq("user_id",x.id).single();if(!g||!["ADMIN","EDITOR"].includes(g.role))return t.jsx("div",{className:"py-8 px-6",children:(0,t.jsxs)(l.Zb,{className:"border-destructive",children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"Zugriff verweigert"})}),t.jsx(l.aY,{children:t.jsx("p",{children:"Sie ben\xf6tigen Editor- oder Administrator-Rechte."})})]})});let{data:_}=await s.from("shifts").select(`
      *,
      division:divisions(id, name),
      assignments:assignments(id, vehicle_key, slot_key, person_id, from_trupp_key, placeholder_text)
    `).eq("id",e.id).eq("station_id",g.station_id).single();if(_||(0,n.notFound)(),"EDITOR"===g.role&&!(g.division_ids||[]).includes(_.division_id))return t.jsx("div",{className:"py-8 px-6",children:(0,t.jsxs)(l.Zb,{className:"border-destructive",children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"Zugriff verweigert"})}),t.jsx(l.aY,{children:t.jsx("p",{children:"Sie haben keinen Zugriff auf Schichten dieser Division."})})]})});let f=s.from("divisions").select("*").eq("station_id",g.station_id);"EDITOR"===g.role&&g.division_ids&&g.division_ids.length>0&&(f=f.in("id",g.division_ids));let{data:j}=await f.order("name",{ascending:!0}),{data:k}=await s.from("vehicle_configs").select("*").eq("station_id",g.station_id).order("order",{ascending:!0}).returns(),{data:v}=await s.from("people").select("*").eq("station_id",g.station_id).eq("active",!0).order("name",{ascending:!0}),{data:b}=await s.from("shift_templates").select("*").eq("station_id",g.station_id).order("label",{ascending:!0}),y=k??[],w=new Map,N=new Map;y.forEach(e=>{w.set(e.key,e.id),N.set(e.key,e)});let P={},q={},E={},S={};console.log("Edit page - shift.assignments:",_.assignments);let T=new Map;_.assignments?.forEach(e=>{let i=w.get(e.vehicle_key);if(i){if(e.from_trupp_key){let s=e.slot_key;if(s.includes(":")){let t=s.split(":")[0],a=`${i}:${t}`;if(!T.has(a)){T.set(a,new Set);let s=e.from_trupp_key,n=null;k?.forEach(e=>{let i=e.config;i.trupps?.some(e=>e.key===s)&&(n=e.id)}),n&&(q[i]||(q[i]=[]),q[i].push({sourceVehicleId:n,sourceTruppKey:s,targetTruppKey:t}))}T.get(a).add(e.from_trupp_key)}}if("Praktikant"===e.slot_key||"Praktikant"===e.placeholder_text){let s=N.get(e.vehicle_key),t=s?.config;t?.trupps&&0!==t.trupps.length||(E[i]=!0)}if(e.slot_key&&e.slot_key.includes(":")){let s=e.slot_key.split(":");if(2===s.length&&"Praktikant"===s[1]){let e=s[0];S[i]||(S[i]={}),S[i][e]=!0}}P[i]||(P[i]={}),P[i][e.slot_key]=e.person_id}}),console.log("Edit page - existingAssignments:",P),console.log("Edit page - existingCopiedTrupps:",q),console.log("Edit page - existingPraktikantFlags:",E),console.log("Edit page - existingTruppPraktikantFlags:",S);let Z=e=>{let i=e.split("T")[1];if(i){let[e,s]=i.split(":");return`${e}:${s}`}return"00:00"};return(0,t.jsxs)("div",{className:"py-8 px-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[t.jsx(r.default,{href:"/app/shifts",children:(0,t.jsxs)(d.z,{variant:"ghost",size:"sm",className:"mb-4",children:[t.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"Zur\xfcck zur \xdcbersicht"]})}),t.jsx("h1",{className:"text-3xl font-bold",children:"Schicht bearbeiten"}),t.jsx("p",{className:"text-muted-foreground",children:"Bearbeiten Sie den Dienstplan f\xfcr diese Schicht"})]}),i.error&&t.jsx(l.Zb,{className:"mb-6 border-destructive",children:t.jsx(l.aY,{className:"pt-6",children:t.jsx("p",{className:"text-destructive",children:i.error})})}),i.success&&t.jsx(l.Zb,{className:"mb-6 border-green-500",children:t.jsx(l.aY,{className:"pt-6",children:t.jsx("p",{className:"text-green-600",children:i.success})})}),(0,t.jsxs)("form",{action:m.updateShiftComplete,className:"space-y-6",children:[t.jsx("input",{type:"hidden",name:"shift_id",value:_.id}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[t.jsx(l.ll,{children:"Schicht-Details"}),t.jsx(l.SZ,{children:"Grundlegende Informationen zur Schicht"})]}),(0,t.jsxs)(l.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(c._,{htmlFor:"shift-date",children:"Datum *"}),t.jsx(o.I,{id:"shift-date",name:"date",type:"date",required:!0,defaultValue:_.starts_at.split("T")[0]})]}),t.jsx(u.V,{templates:b||[],defaultStartTime:Z(_.starts_at),defaultEndTime:Z(_.ends_at)}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(c._,{htmlFor:"shift-division",children:"Wachabteilung *"}),(0,t.jsxs)("select",{id:"shift-division",name:"division_id",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",required:!0,defaultValue:_.division_id,children:[t.jsx("option",{value:"",children:"W\xe4hlen Sie eine Wachabteilung"}),j?.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"wachleitung-im-haus",name:"wachleitung_im_haus",defaultChecked:_.wachleitung_im_haus,className:"h-4 w-4 rounded border-gray-300"}),t.jsx(c._,{htmlFor:"wachleitung-im-haus",className:"cursor-pointer",children:"Wachleitung im Haus"})]})]})]}),t.jsx(h.s,{vehicles:y,people:v||[],divisions:j||[],divisionId:_.division_id,initialAssignments:P,initialCopiedTrupps:q,initialPraktikantFlags:E,initialTruppPraktikantFlags:S}),(0,t.jsxs)("div",{className:"flex gap-4 justify-end",children:[t.jsx(r.default,{href:"/app/shifts",children:t.jsx(d.z,{type:"button",variant:"outline",children:"Abbrechen"})}),t.jsx(d.z,{type:"submit",children:"\xc4nderungen speichern"})]})]})]})}}};var i=require("../../../../../../webpack-runtime.js");i.C(e);var s=e=>i(i.s=e),t=i.X(0,[276,374,702,582,559,369,4,226,101,863,916],()=>s(74166));module.exports=t})();