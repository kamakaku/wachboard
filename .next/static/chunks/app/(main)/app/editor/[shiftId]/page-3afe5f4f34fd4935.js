(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{3873:function(e,t,r){Promise.resolve().then(r.bind(r,562))},562:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(7437),s=r(1660),a=r(2265),l=r(3448),i=r(9820),o=r(1905),c=r(6246);function d(e){var t;let{person:r,id:a,fromSlot:d,isOverlay:u=!1}=e,{attributes:f,listeners:m,setNodeRef:p,transform:x,isDragging:h}=(0,s.O1)({id:a,data:{type:"person",person:r,fromSlot:d}}),g=x?{transform:"translate3d(".concat(x.x,"px, ").concat(x.y,"px, 0)")}:void 0;return(0,n.jsxs)(i.Zb,{ref:p,style:g,className:(0,l.cn)("p-2 flex items-center gap-3 touch-none bg-background",h&&"opacity-50 z-50",u&&"shadow-lg"),children:[(0,n.jsx)("div",{...m,...f,className:"cursor-grab",children:(0,n.jsx)(o.Z,{className:"h-5 w-5 text-muted-foreground"})}),(0,n.jsx)(c.q,{src:r.photo_url,name:r.name,size:36,className:"flex-shrink-0"}),(0,n.jsxs)("div",{className:"min-w-0",children:[(0,n.jsx)("p",{className:"font-semibold truncate",children:r.name}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:null!==(t=r.rank)&&void 0!==t?t:"â€“"})]})]})}function u(e){let{children:t,onDragEnd:r}=e,[l,i]=(0,a.useState)(null),o=(0,s.Dy)((0,s.VT)(s.we,{activationConstraint:{distance:8}}));return(0,n.jsxs)(s.LB,{sensors:o,onDragStart:e=>{i(e.active.id)},onDragEnd:r,onDragCancel:()=>{i(null)},children:[t,(0,n.jsx)(s.y9,{children:l&&l.startsWith("person-")?(0,n.jsx)(d,{id:l,person:{id:l.replace("person-",""),name:"Dragging",rank:"...",station_id:"",active:!0,created_at:"",photo_url:null,tags:null},isOverlay:!0}):null})]})}var f=r(279);function m(e){let{people:t,assignedPersonIds:r}=e,s=t.filter(e=>!r.has(e.id));return(0,n.jsxs)(i.Zb,{className:"h-full",children:[(0,n.jsxs)(i.Ol,{children:[(0,n.jsx)(i.ll,{children:"Personal"}),(0,n.jsx)(f.I,{placeholder:"Personal suchen..."})]}),(0,n.jsx)(i.aY,{className:"space-y-2 h-[calc(100vh-200px)] overflow-y-auto",children:s.length>0?s.map(e=>(0,n.jsx)(d,{id:"person-".concat(e.id),person:e},e.id)):(0,n.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"Kein Personal verf\xfcgbar"})})]})}function p(e){let{id:t,slotName:r,slotDescription:a,person:i,className:o,data:c}=e,{isOver:u,setNodeRef:f}=(0,s.Zj)({id:t,data:c});return(0,n.jsxs)("div",{ref:f,className:(0,l.cn)("transition-colors",u?"bg-primary/10 rounded-md":""),children:[(0,n.jsx)("div",{className:"flex justify-between items-center w-full mb-1",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:r}),a&&(0,n.jsx)("p",{className:"text-xs text-muted-foreground/80",children:a})]})}),(0,n.jsx)("div",{className:(0,l.cn)("p-2 rounded-md border border-dashed min-h-[60px] flex flex-col justify-center",u?"border-primary":"border-border",o),children:i?(0,n.jsx)(d,{person:i,id:"person-".concat(i.id),fromSlot:t}):(0,n.jsx)("div",{className:"text-center text-sm text-muted-foreground/50 py-2.5",children:"Leer"})})]})}var x=r(7151);function h(e){let{vehicle:t,assignments:r}=e,s=t.config,a=(e,t)=>{var s;let a="".concat(t,"-").concat(e.key),l=null!==(s=r.get(a))&&void 0!==s?s:null;return(0,n.jsx)(p,{id:a,slotName:e.label,slotDescription:e.description,person:l,data:{type:"slot",data:{vehicleKey:t,slotKey:e.key}}},a)};return(0,n.jsxs)(i.Zb,{children:[(0,n.jsx)(i.Ol,{children:(0,n.jsx)(i.ll,{children:t.title})}),(0,n.jsxs)(i.aY,{className:"space-y-4",children:[s.trupps&&s.trupps.map(e=>{let r=(0,x.Qo)(e);return(0,n.jsxs)("div",{className:"p-3 border rounded-md bg-muted/20",children:[(0,n.jsx)("h4",{className:"font-semibold mb-1",children:r.label}),r.description&&(0,n.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:r.description}),(0,n.jsx)("div",{className:"space-y-2",children:r.slots.map(e=>a(e,t.key))})]},r.key)}),s.slots&&(0,n.jsx)("div",{className:"space-y-2",children:s.slots.map(e=>a((0,x.CJ)(e),t.key))})]})]})}r(3079);var g=(0,r(2119).$)("38ba9b23314e78b67bd93861e9d28da4faa26421"),v=r(8933),j=r(4438);function b(e){let{params:t}=e,{shiftId:r}=t,s=(0,v.e)(),[l,i]=(0,a.useTransition)(),[o,c]=(0,a.useState)(null),[d,f]=(0,a.useState)([]),[p,x]=(0,a.useState)([]),[b,N]=(0,a.useState)(new Map),[w,k]=(0,a.useState)(new Map);(0,a.useEffect)(()=>{(async()=>{let{data:e,error:t}=await s.from("shifts").select("*, station:stations(name), division:divisions(name)").eq("id",r).single();if(t||!e)return console.error("Error fetching shift",t);c(e);let{data:n,error:a}=await s.from("people").select("*").eq("station_id",e.station_id);if(a)return console.error("Error fetching people",a);let l=n||[];f(l),k(new Map(l.map(e=>[e.id,e])));let{data:i,error:o}=await s.from("vehicle_configs").select("*").eq("station_id",e.station_id).order("order",{ascending:!0});if(o)return console.error("Error fetching vehicles",o);x(i||[]);let{data:d,error:u}=await s.from("assignments").select("*, people(*)").eq("shift_id",r);if(u)return console.error("Error fetching assignments",u);let m=new Map;if(d)for(let e of d){let t="".concat(e.vehicle_key,"-").concat(e.slot_key);m.set(t,e.people)}N(m)})()},[r,s]);let I=async e=>{var t,n,s;let{active:a,over:l}=e;if(!l){let e=null===(s=a.data.current)||void 0===s?void 0:s.fromSlot;if(e){let t=new Map(b);t.set(e,null),N(t);let{vehicleKey:n,slotKey:s}=y(e);i(async()=>{let e=await g({shiftId:r,vehicleKey:n,slotKey:s,personId:null});e.success||j.Am.error(e.message)})}return}let o=null===(t=a.data.current)||void 0===t?void 0:t.person,c=null===(n=a.data.current)||void 0===n?void 0:n.fromSlot,d=l.id;if(!o||d===c)return;let u=new Map(b);c&&u.set(c,null),u.set(d,o),N(u);let{vehicleKey:f,slotKey:m}=y(d);i(async()=>{let e=await g({shiftId:r,vehicleKey:f,slotKey:m,personId:o.id});e.success||(j.Am.error(e.message),N(new Map(b)))})},_=new Set(Array.from(b.values()).filter(Boolean).map(e=>e.id));return o?(0,n.jsx)(u,{onDragEnd:I,children:(0,n.jsxs)("div",{className:"container mx-auto py-4 h-[calc(100vh-80px)]",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("h1",{className:"text-2xl font-bold",children:[o.station.name," - ",o.division.name]}),(0,n.jsxs)("p",{className:"text-muted-foreground",children:[new Date(o.starts_at).toLocaleString("de-DE")," - ",new Date(o.ends_at).toLocaleString("de-DE")," (",o.label,")"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-full",children:[(0,n.jsx)("div",{className:"lg:col-span-1 h-full",children:(0,n.jsx)(m,{people:d,assignedPersonIds:_})}),(0,n.jsx)("div",{className:"lg:col-span-3 space-y-4 h-full overflow-y-auto pb-8",children:p.map(e=>(0,n.jsx)(h,{vehicle:{...e,config:e.config},assignments:b},e.key))})]})]})}):(0,n.jsx)("div",{className:"container py-8 text-center",children:"Lade Schichtdaten..."})}function y(e){let t=e.split("-"),r=t.pop();return{vehicleKey:t.join("-"),slotKey:r}}},6246:function(e,t,r){"use strict";r.d(t,{q:function(){return l}});var n=r(7437),s=r(3145),a=r(3448);function l(e){let{src:t,name:r,size:l=36,className:i}=e,o=r?r.split(" ").filter(Boolean).map(e=>e[0]).slice(0,2).join("").toUpperCase():"";return(0,n.jsx)("div",{className:(0,a.cn)("relative overflow-hidden rounded-full bg-muted text-muted-foreground/70 flex items-center justify-center border border-border flex-shrink-0",i),style:{width:l,height:l},children:t?(0,n.jsx)(s.default,{src:t,alt:null!=r?r:"Avatar",width:l,height:l,className:"object-cover w-full h-full",unoptimized:!0}):(0,n.jsx)("span",{style:{fontSize:.4*l},className:"font-semibold",children:o||"?"})})}},9820:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return o}});var n=r(7437),s=r(2265),a=r(3448);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},279:function(e,t,r){"use strict";r.d(t,{I:function(){return l}});var n=r(7437),s=r(2265),a=r(3448);let l=s.forwardRef((e,t)=>{let{className:r,type:s,...l}=e;return(0,n.jsx)("input",{type:s,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});l.displayName="Input"},8933:function(e,t,r){"use strict";r.d(t,{e:function(){return s}});var n=r(1259);function s(){return(0,n.createBrowserClient)("https://ghjfyjximndlrstwridq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoamZ5anhpbW5kbHJzdHdyaWRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NzczNjgsImV4cCI6MjA4MjU1MzM2OH0.kn8-ZKY2EYmIjm8H3bIiXsMeHHz7355LIdMrgBr4GpQ")}},3448:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(1994),s=r(3335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}},7151:function(e,t,r){"use strict";function n(e){var t;return"string"==typeof e?{key:e,label:e}:{key:e.key,label:null!==(t=e.label)&&void 0!==t?t:e.key,description:e.description}}function s(e){return{...e,slots:e.slots.map(n)}}r.d(t,{CJ:function(){return n},Qo:function(){return s}})}},function(e){e.O(0,[137,145,438,172,253,971,117,744],function(){return e(e.s=3873)}),_N_E=e.O()}]);