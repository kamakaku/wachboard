(()=>{var e={};e.id=786,e.ids=[786],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},57221:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>s.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>f,tree:()=>l}),t(52309),t(95795),t(35866),t(32029);var a=t(23191),i=t(88716),n=t(37922),s=t.n(n),o=t(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);t.d(r,d);let l=["",{children:["(auth)",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,52309)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(auth)/onboarding/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,95795)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(auth)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,32029)),"/Users/kamakaku/_desiqn/__wachboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kamakaku/_desiqn/__wachboard/src/app/(auth)/onboarding/page.tsx"],u="/(auth)/onboarding/page",m={require:t,loadChunk:()=>Promise.resolve()},f=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(auth)/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},95584:(e,r,t)=>{let a={"4ca3e45e59d17eb24834057aa663cd58822f0362":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.rejectJoinRequest),"64819fdbf6747c9de70c4f6c789726e25ed33dab":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.getAllStations),"7718239856a5ecd6b6dd9302e4f387114b4eed56":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.acceptJoinRequest),"935a02ff5ad3f32514a031e75fad6c1a300ce60f":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.createStationAndBecomeAdmin),"952f7879cdccaeee0d550ce745157068cc57c2fa":()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.inviteUserByEmail),cb7bd06c1d01ccb171f3a399726de42085eec918:()=>Promise.resolve().then(t.bind(t,66561)).then(e=>e.requestToJoinStation)};async function i(e,...r){return(await a[e]()).apply(null,r)}e.exports={"4ca3e45e59d17eb24834057aa663cd58822f0362":i.bind(null,"4ca3e45e59d17eb24834057aa663cd58822f0362"),"64819fdbf6747c9de70c4f6c789726e25ed33dab":i.bind(null,"64819fdbf6747c9de70c4f6c789726e25ed33dab"),"7718239856a5ecd6b6dd9302e4f387114b4eed56":i.bind(null,"7718239856a5ecd6b6dd9302e4f387114b4eed56"),"935a02ff5ad3f32514a031e75fad6c1a300ce60f":i.bind(null,"935a02ff5ad3f32514a031e75fad6c1a300ce60f"),"952f7879cdccaeee0d550ce745157068cc57c2fa":i.bind(null,"952f7879cdccaeee0d550ce745157068cc57c2fa"),cb7bd06c1d01ccb171f3a399726de42085eec918:i.bind(null,"cb7bd06c1d01ccb171f3a399726de42085eec918")}},96105:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},75675:()=>{},68453:(e,r,t)=>{Promise.resolve().then(t.bind(t,44794)),Promise.resolve().then(t.bind(t,50384))},35303:()=>{},44794:(e,r,t)=>{"use strict";t.d(r,{Label:()=>l});var a=t(10326),i=t(17577),n=t(29152),s=t(79360),o=t(51223);let d=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=i.forwardRef(({className:e,...r},t)=>a.jsx(n.f,{ref:t,className:(0,o.cn)(d(),e),...r}));l.displayName=n.f.displayName},50384:(e,r,t)=>{"use strict";t.d(r,{Tabs:()=>o,TabsContent:()=>c,TabsList:()=>d,TabsTrigger:()=>l});var a=t(10326),i=t(17577),n=t(28407),s=t(51223);let o=n.fC,d=i.forwardRef(({className:e,...r},t)=>a.jsx(n.aV,{ref:t,className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...r}));d.displayName=n.aV.displayName;let l=i.forwardRef(({className:e,...r},t)=>a.jsx(n.xz,{ref:t,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r}));l.displayName=n.xz.displayName;let c=i.forwardRef(({className:e,...r},t)=>a.jsx(n.VY,{ref:t,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r}));c.displayName=n.VY.displayName},51223:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var a=t(41135),i=t(31009);function n(...e){return(0,i.m6)((0,a.W)(e))}},95795:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var a=t(19510);function i({children:e}){return a.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-secondary",children:e})}},52309:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var a=t(19510),i=t(65655),n=t(58585),s=t(93804),o=t(27039),d=t(49922),l=t(40278),c=t(43405),u=t(66561),m=t(94725);async function f({searchParams:e}){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();t||(0,n.redirect)("/login");let{data:f}=await r.from("memberships").select("id").eq("user_id",t.id).limit(1).single();f&&(0,n.redirect)("/app");let{data:g}=await r.from("join_requests").select("id, station:stations(name), created_at").eq("user_id",t.id).eq("status","PENDING"),{data:h}=await r.from("stations").select("id, name, org:organizations(name)").order("name",{ascending:!0});return(0,a.jsxs)("div",{className:"container max-w-4xl py-8",children:[(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Willkommen bei ",c.i]}),a.jsx("p",{className:"text-muted-foreground",children:"W\xe4hlen Sie eine bestehende Wache aus oder erstellen Sie eine neue."})]}),e.error&&a.jsx(s.Zb,{className:"mb-6 border-destructive",children:a.jsx(s.aY,{className:"pt-6",children:a.jsx("p",{className:"text-destructive",children:e.error})})}),e.success&&a.jsx(s.Zb,{className:"mb-6 border-green-500",children:a.jsx(s.aY,{className:"pt-6",children:a.jsx("p",{className:"text-green-600",children:e.success})})}),g&&g.length>0&&(0,a.jsxs)(s.Zb,{className:"mb-6",children:[(0,a.jsxs)(s.Ol,{children:[a.jsx(s.ll,{children:"Ausstehende Anfragen"}),a.jsx(s.SZ,{children:"Sie haben bereits Beitrittsanfragen gesendet. Bitte warten Sie auf die Best\xe4tigung eines Administrators."})]}),a.jsx(s.aY,{children:a.jsx("div",{className:"space-y-2",children:g.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded-md",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.station?.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Gesendet am"," ",new Date(e.created_at).toLocaleDateString("de-DE")]})]}),a.jsx("span",{className:"text-sm px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full",children:"Ausstehend"})]},e.id))})})]}),(0,a.jsxs)(m.mQ,{defaultValue:"join",className:"w-full",children:[(0,a.jsxs)(m.dr,{className:"grid w-full grid-cols-2",children:[a.jsx(m.SP,{value:"join",children:"Wache beitreten"}),a.jsx(m.SP,{value:"create",children:"Neue Wache erstellen"})]}),a.jsx(m.nU,{value:"join",children:(0,a.jsxs)(s.Zb,{children:[(0,a.jsxs)(s.Ol,{children:[a.jsx(s.ll,{children:"Einer Wache beitreten"}),a.jsx(s.SZ,{children:"W\xe4hlen Sie eine bestehende Wache aus und senden Sie eine Beitrittsanfrage."})]}),a.jsx(s.aY,{children:h&&h.length>0?a.jsx("div",{className:"space-y-3",children:h.map(e=>(0,a.jsxs)("form",{action:u.requestToJoinStation,className:"flex justify-between items-center p-4 border rounded-md hover:bg-accent transition-colors",children:[a.jsx("input",{type:"hidden",name:"stationId",value:e.id}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.name}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.org?.name||"Keine Organisation"})]}),a.jsx(o.z,{type:"submit",variant:"outline",children:"Beitreten"})]},e.id))}):a.jsx("p",{className:"text-muted-foreground",children:"Keine Wachen verf\xfcgbar. Erstellen Sie eine neue Wache."})})]})}),a.jsx(m.nU,{value:"create",children:(0,a.jsxs)(s.Zb,{children:[(0,a.jsxs)(s.Ol,{children:[a.jsx(s.ll,{children:"Neue Wache erstellen"}),a.jsx(s.SZ,{children:"Erstellen Sie eine neue Wache. Sie werden automatisch als Administrator hinzugef\xfcgt."})]}),a.jsx(s.aY,{children:(0,a.jsxs)("form",{action:u.createStationAndBecomeAdmin,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(l._,{htmlFor:"stationName",children:"Name der Wache *"}),a.jsx(d.I,{id:"stationName",name:"stationName",placeholder:"z.B. Wache 1, Feuerwache Nord",required:!0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(l._,{htmlFor:"organizationName",children:"Organisation (optional)"}),a.jsx(d.I,{id:"organizationName",name:"organizationName",placeholder:"z.B. Feuerwehr M\xfcnchen"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Wenn leer, wird die Standard-Organisation verwendet oder eine neue erstellt."})]}),a.jsx(o.z,{type:"submit",className:"w-full",children:"Wache erstellen und Administrator werden"})]})})]})})]})]})}},32029:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d,metadata:()=>o});var a=t(19510),i=t(38538),n=t.n(i);t(5023);var s=t(40644);let o={title:"Wachboard",description:"Dienst- & Fahrzeugbesetzung f\xfcr Feuerwehren"};function d({children:e}){return a.jsx("html",{lang:"de",suppressHydrationWarning:!0,children:a.jsx("body",{className:(0,s.cn)("min-h-screen bg-background font-sans antialiased",n().variable),children:e})})}},27039:(e,r,t)=>{"use strict";t.d(r,{z:()=>l});var a=t(19510),i=t(71159),n=t(43025),s=t(46145),o=t(40644);let d=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=i.forwardRef(({className:e,variant:r,size:t,asChild:i=!1,...s},l)=>{let c=i?n.g7:"button";return a.jsx(c,{className:(0,o.cn)(d({variant:r,size:t,className:e})),ref:l,...s})});l.displayName="Button"},93804:(e,r,t)=>{"use strict";t.d(r,{Ol:()=>o,SZ:()=>l,Zb:()=>s,aY:()=>c,ll:()=>d});var a=t(19510),i=t(71159),n=t(40644);let s=i.forwardRef(({className:e,...r},t)=>a.jsx("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));s.displayName="Card";let o=i.forwardRef(({className:e,...r},t)=>a.jsx("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...r}));o.displayName="CardHeader";let d=i.forwardRef(({className:e,...r},t)=>a.jsx("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));d.displayName="CardTitle";let l=i.forwardRef(({className:e,...r},t)=>a.jsx("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",e),...r}));l.displayName="CardDescription";let c=i.forwardRef(({className:e,...r},t)=>a.jsx("div",{ref:t,className:(0,n.cn)("p-6 pt-0",e),...r}));c.displayName="CardContent",i.forwardRef(({className:e,...r},t)=>a.jsx("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter"},49922:(e,r,t)=>{"use strict";t.d(r,{I:()=>s});var a=t(19510),i=t(71159),n=t(40644);let s=i.forwardRef(({className:e,type:r,...t},i)=>a.jsx("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));s.displayName="Input"},40278:(e,r,t)=>{"use strict";t.d(r,{_:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/label.tsx#Label`)},94725:(e,r,t)=>{"use strict";t.d(r,{SP:()=>s,dr:()=>n,mQ:()=>i,nU:()=>o});var a=t(68570);let i=(0,a.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#Tabs`),n=(0,a.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsList`),s=(0,a.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsTrigger`),o=(0,a.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsContent`)},66561:(e,r,t)=>{"use strict";t.r(r),t.d(r,{acceptJoinRequest:()=>c,createStationAndBecomeAdmin:()=>o,getAllStations:()=>l,inviteUserByEmail:()=>m,rejectJoinRequest:()=>u,requestToJoinStation:()=>d});var a=t(24330);t(60166);var i=t(65655),n=t(57708),s=t(58585);async function o(e){let r;let t=(0,i.e)(),{data:{user:a},error:o}=await t.auth.getUser();if(console.log("Auth check:",{user:a?.id,email:a?.email,error:o}),!a)return(0,s.redirect)("/onboarding?error=Sie sind nicht angemeldet. Bitte melden Sie sich an.");let d=e.get("stationName"),l=e.get("organizationName");if(console.log("Creating station:",{stationName:d,organizationName:l,userId:a.id}),!d||""===d.trim())return(0,s.redirect)("/onboarding?error=Wachen-Name ist erforderlich.");let{data:c}=await t.from("memberships").select("id").eq("user_id",a.id).limit(1).single();if(c)return(0,s.redirect)("/app");if(l&&""!==l.trim()){let{data:e,error:a}=await t.from("organizations").insert({name:l.trim()}).select("id").single();if(a||!e){console.error("Error creating organization:",a);let e=a?`${a.message} (Code: ${a.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Organisation: ${e}`)}`)}r=e.id}else{let{data:e}=await t.from("organizations").select("id").limit(1).single();if(e)r=e.id;else{let{data:e,error:a}=await t.from("organizations").insert({name:"Standard Organisation"}).select("id").single();if(a||!e){console.error("Error creating default organization:",a);let e=a?`${a.message} (Code: ${a.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Standard-Organisation: ${e}`)}`)}r=e.id}}let{data:u,error:m}=await t.from("stations").insert({org_id:r,name:d.trim()}).select("id").single();if(m||!u){console.error("Error creating station:",m);let e=m?`${m.message} (Code: ${m.code})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Erstellen der Wache: ${e}`)}`)}console.log("Attempting to create membership:",{user_id:a.id,station_id:u.id,role:"ADMIN"});let{data:f,error:g}=await t.from("memberships").insert({user_id:a.id,station_id:u.id,role:"ADMIN"}).select();if(console.log("Membership result:",{data:f,error:g}),g){console.error("Error creating membership:",g);let e=g?`${g.message} (Code: ${g.code}, Details: ${g.details})`:"Unbekannter Fehler";return(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Zuweisen der Admin-Rolle: ${e}`)}`)}(0,n.revalidatePath)("/app"),(0,s.redirect)("/app")}async function d(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("stationId");if(!a)return(0,s.redirect)("/onboarding?error=Keine Wache ausgew\xe4hlt.");let{data:n}=await r.from("memberships").select("id, station_id").eq("user_id",t.id);if(n&&n.length>0)return(0,s.redirect)("/app");let{data:o,error:d}=await r.from("stations").select("id, name").eq("id",a).single();if(d||!o)return console.error("Station lookup error:",d),(0,s.redirect)("/onboarding?error=Wache nicht gefunden.");let{data:l}=await r.from("join_requests").select("id, status").eq("user_id",t.id).eq("station_id",a).single();if(l){if("PENDING"===l.status)return(0,s.redirect)("/onboarding?success=Sie haben bereits eine ausstehende Anfrage f\xfcr diese Wache.");if("REJECTED"===l.status)return(0,s.redirect)("/onboarding?error=Ihre Anfrage f\xfcr diese Wache wurde abgelehnt. Bitte kontaktieren Sie einen Administrator.")}let{data:c,error:u}=await r.from("join_requests").insert({user_id:t.id,station_id:a,status:"PENDING"}).select();if(u)return(console.error("Error creating join request:",u),console.error("Error details:",{code:u.code,message:u.message,details:u.details,hint:u.hint}),"23505"===u.code)?(0,s.redirect)("/onboarding?success=Sie haben bereits eine Anfrage f\xfcr diese Wache gestellt."):(0,s.redirect)(`/onboarding?error=${encodeURIComponent(`Fehler beim Senden der Beitrittsanfrage: ${u.message}`)}`);console.log("Join request created successfully:",c),(0,s.redirect)("/onboarding?success=Beitrittsanfrage gesendet! Warten Sie auf die Best\xe4tigung eines Administrators.")}async function l(){let e=(0,i.e)(),{data:r,error:t}=await e.from("stations").select("id, name, org:organizations(name)").order("name",{ascending:!0});return t?(console.error("Error fetching stations:",t),[]):r||[]}async function c(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("requestId"),o=e.get("divisionIds"),d=e.get("role");if(!a||!d)return(0,s.redirect)("/app/join-requests?error=Fehlende Parameter.");let l=o&&""!==o.trim()?o.split(",").filter(e=>""!==e.trim()):[],{data:c,error:u}=await r.from("join_requests").select("*, station:stations(id)").eq("id",a).single();if(u||!c)return(0,s.redirect)("/app/join-requests?error=Beitrittsanfrage nicht gefunden.");let{data:m}=await r.from("memberships").select("role").eq("user_id",t.id).eq("station_id",c.station.id).single();if(!m||"ADMIN"!==m.role)return(0,s.redirect)("/app/join-requests?error=Keine Berechtigung.");let f={user_id:c.user_id,station_id:c.station_id,role:d};"EDITOR"===d&&l.length>0&&(f.division_ids=l,f.division_id=l[0]),console.log("Creating membership with data:",f);let{data:g,error:h}=await r.from("memberships").insert(f).select();if(h)return console.error("Error creating membership:",h),console.error("Error details:",{code:h.code,message:h.message,details:h.details,hint:h.hint}),(0,s.redirect)(`/app/join-requests?error=${encodeURIComponent("Fehler beim Erstellen der Mitgliedschaft: "+h.message)}`);console.log("Membership created successfully:",g);let{error:b}=await r.from("join_requests").update({status:"APPROVED"}).eq("id",a);b&&console.error("Error updating join request:",b),(0,n.revalidatePath)("/app/join-requests"),(0,n.revalidatePath)("/app/users"),(0,s.redirect)("/app/join-requests?success=Beitrittsanfrage akzeptiert.")}async function u(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("requestId");if(!a)return(0,s.redirect)("/admin?error=Fehlende Parameter.");let{data:o,error:d}=await r.from("join_requests").select("*, station:stations(id)").eq("id",a).single();if(d||!o)return(0,s.redirect)("/admin?error=Beitrittsanfrage nicht gefunden.");let{data:l}=await r.from("memberships").select("role").eq("user_id",t.id).eq("station_id",o.station.id).single();if(!l||"ADMIN"!==l.role)return(0,s.redirect)("/admin?error=Keine Berechtigung.");let{error:c}=await r.from("join_requests").update({status:"REJECTED"}).eq("id",a);if(c)return console.error("Error updating join request:",c),(0,s.redirect)("/app/join-requests?error=Fehler beim Ablehnen der Anfrage.");(0,n.revalidatePath)("/app/join-requests"),(0,s.redirect)("/app/join-requests?success=Beitrittsanfrage abgelehnt.")}async function m(e){let r=(0,i.e)(),{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated.");let a=e.get("email"),o=e.get("role"),d=e.get("divisionIds");if(!a||!o)return(0,s.redirect)("/app/users?error=Fehlende Parameter.");let l=d&&""!==d.trim()?d.split(",").filter(e=>""!==e.trim()):[],{data:c}=await r.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!c||"ADMIN"!==c.role)return(0,s.redirect)("/app/users?error=Keine Berechtigung.");let{data:u}=await r.from("users_profile").select("id").eq("email",a.toLowerCase().trim()).single();if(!u)return(0,s.redirect)("/app/users?error=Kein Benutzer mit dieser E-Mail-Adresse gefunden. Der Benutzer muss sich zuerst registrieren.");let{data:m}=await r.from("memberships").select("id").eq("user_id",u.id).eq("station_id",c.station_id).single();if(m)return(0,s.redirect)("/app/users?error=Benutzer ist bereits Mitglied dieser Wache.");let f={user_id:u.id,station_id:c.station_id,role:o};"EDITOR"===o&&l.length>0&&(f.division_ids=l,f.division_id=l[0]);let{error:g}=await r.from("memberships").insert(f);if(g)return console.error("Error creating membership:",g),(0,s.redirect)("/app/users?error=Fehler beim Hinzuf\xfcgen des Benutzers.");(0,n.revalidatePath)("/app/users"),(0,s.redirect)("/app/users?success=Benutzer erfolgreich hinzugef\xfcgt.")}(0,t(40618).h)([o,d,l,c,u,m]),(0,a.j)("935a02ff5ad3f32514a031e75fad6c1a300ce60f",o),(0,a.j)("cb7bd06c1d01ccb171f3a399726de42085eec918",d),(0,a.j)("64819fdbf6747c9de70c4f6c789726e25ed33dab",l),(0,a.j)("7718239856a5ecd6b6dd9302e4f387114b4eed56",c),(0,a.j)("4ca3e45e59d17eb24834057aa663cd58822f0362",u),(0,a.j)("952f7879cdccaeee0d550ce745157068cc57c2fa",m)},43405:(e,r,t)=>{"use strict";t.d(r,{i:()=>a});let a="Wachboard"},65655:(e,r,t)=>{"use strict";t.d(r,{e:()=>n});var a=t(67721),i=t(71615);function n(){let e=(0,i.cookies)();return(0,a.createServerClient)("https://ghjfyjximndlrstwridq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoamZ5anhpbW5kbHJzdHdyaWRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NzczNjgsImV4cCI6MjA4MjU1MzM2OH0.kn8-ZKY2EYmIjm8H3bIiXsMeHHz7355LIdMrgBr4GpQ",{cookies:{get:r=>e.get(r)?.value,set(r,t,a){try{e.set({name:r,value:t,...a})}catch(e){}},remove(r,t){try{e.set({name:r,value:"",...t})}catch(e){}}}})}},40644:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var a=t(55761),i=t(62386);function n(...e){return(0,i.m6)((0,a.W)(e))}},5023:()=>{},29152:(e,r,t)=>{"use strict";t.d(r,{f:()=>d});var a=t(17577);t(60962);var i=t(34214),n=t(10326),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,i.Z8)(`Primitive.${r}`),s=a.forwardRef((e,a)=>{let{asChild:i,...s}=e,o=i?t:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(o,{...s,ref:a})});return s.displayName=`Primitive.${r}`,{...e,[r]:s}},{}),o=a.forwardRef((e,r)=>(0,n.jsx)(s.label,{...e,ref:r,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));o.displayName="Label";var d=o},28407:(e,r,t)=>{"use strict";t.d(r,{VY:()=>z,aV:()=>E,fC:()=>I,xz:()=>S});var a=t(17577),i=t(82561),n=t(93095),s=t(15594),o=t(9815),d=t(77335),l=t(17124),c=t(52067),u=t(88957),m=t(10326),f="Tabs",[g,h]=(0,n.b)(f,[s.Pc]),b=(0,s.Pc)(),[p,x]=g(f),v=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:a,onValueChange:i,defaultValue:n,orientation:s="horizontal",dir:o,activationMode:g="automatic",...h}=e,b=(0,l.gm)(o),[x,v]=(0,c.T)({prop:a,onChange:i,defaultProp:n??"",caller:f});return(0,m.jsx)(p,{scope:t,baseId:(0,u.M)(),value:x,onValueChange:v,orientation:s,dir:b,activationMode:g,children:(0,m.jsx)(d.WV.div,{dir:b,"data-orientation":s,...h,ref:r})})});v.displayName=f;var j="TabsList",w=a.forwardRef((e,r)=>{let{__scopeTabs:t,loop:a=!0,...i}=e,n=x(j,t),o=b(t);return(0,m.jsx)(s.fC,{asChild:!0,...o,orientation:n.orientation,dir:n.dir,loop:a,children:(0,m.jsx)(d.WV.div,{role:"tablist","aria-orientation":n.orientation,...i,ref:r})})});w.displayName=j;var y="TabsTrigger",N=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:a,disabled:n=!1,...o}=e,l=x(y,t),c=b(t),u=k(l.baseId,a),f=P(l.baseId,a),g=a===l.value;return(0,m.jsx)(s.ck,{asChild:!0,...c,focusable:!n,active:g,children:(0,m.jsx)(d.WV.button,{type:"button",role:"tab","aria-selected":g,"aria-controls":f,"data-state":g?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:u,...o,ref:r,onMouseDown:(0,i.Mj)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(a)}),onKeyDown:(0,i.Mj)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(a)}),onFocus:(0,i.Mj)(e.onFocus,()=>{let e="manual"!==l.activationMode;g||n||!e||l.onValueChange(a)})})})});N.displayName=y;var _="TabsContent",q=a.forwardRef((e,r)=>{let{__scopeTabs:t,value:i,forceMount:n,children:s,...l}=e,c=x(_,t),u=k(c.baseId,i),f=P(c.baseId,i),g=i===c.value,h=a.useRef(g);return a.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,m.jsx)(o.z,{present:n||g,children:({present:t})=>(0,m.jsx)(d.WV.div,{"data-state":g?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!t,id:f,tabIndex:0,...l,ref:r,style:{...e.style,animationDuration:h.current?"0s":void 0},children:t&&s})})});function k(e,r){return`${e}-trigger-${r}`}function P(e,r){return`${e}-content-${r}`}q.displayName=_;var I=v,E=w,S=N,z=q}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,374,702,582,559,369],()=>t(57221));module.exports=a})();