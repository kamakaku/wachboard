(()=>{var e={};e.id=118,e.ids=[118],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38053:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>r.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>h,tree:()=>c}),s(18990),s(88834),s(41611),s(35866),s(32029);var i=s(23191),a=s(88716),n=s(37922),r=s.n(n),l=s(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["(main)",{children:["app",{children:["settings",{children:["migrate",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,18990)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/settings/migrate/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,88834)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,41611)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,32029)),"/Users/kamakaku/_desiqn/__wachboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/settings/migrate/page.tsx"],m="/(main)/app/settings/migrate/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/app/settings/migrate/page",pathname:"/app/settings/migrate",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},14468:(e,t,s)=>{let i={"2bb39108e7a2c82847e42b66455619d8ad29b067":()=>Promise.resolve().then(s.bind(s,18990)).then(e=>e.$$ACTION_0),"224786e73ae99791ee2081514241c01b03d7e1f2":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.login),"2c667f50d9672450ffb9c7cc219224fdfd19874c":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.logout),"7aa99930817149a187f1a871bbaf702dea9ea495":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.signup)};async function a(e,...t){return(await i[e]()).apply(null,t)}e.exports={"2bb39108e7a2c82847e42b66455619d8ad29b067":a.bind(null,"2bb39108e7a2c82847e42b66455619d8ad29b067"),"224786e73ae99791ee2081514241c01b03d7e1f2":a.bind(null,"224786e73ae99791ee2081514241c01b03d7e1f2"),"2c667f50d9672450ffb9c7cc219224fdfd19874c":a.bind(null,"2c667f50d9672450ffb9c7cc219224fdfd19874c"),"7aa99930817149a187f1a871bbaf702dea9ea495":a.bind(null,"7aa99930817149a187f1a871bbaf702dea9ea495")}},54331:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,79404,23))},18990:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$ACTION_0:()=>m,default:()=>u});var i=s(19510),a=s(24330);s(60166);var n=s(65655),r=s(58585),l=s(27039),d=s(93804),c=s(57371),o=(0,a.j)("2bb39108e7a2c82847e42b66455619d8ad29b067",m);async function m(){let e=(0,n.e)(),{data:{user:t}}=await e.auth.getUser();t||(0,r.redirect)("/login");let{data:s}=await e.from("memberships").select("station_id, role").eq("user_id",t.id).single();if(!s||"ADMIN"!==s.role)return(0,r.redirect)("/admin/settings?error=Keine Berechtigung.");let i=`TEST_${Date.now()}`,{error:a}=await e.from("shift_templates").insert({station_id:s.station_id,label:i,start_time:"07:00",end_time:"19:00"});return(a||await e.from("shift_templates").delete().eq("station_id",s.station_id).eq("label",i),a)?a.message.includes("violates check constraint")?(0,r.redirect)("/admin/settings/migrate?error="+encodeURIComponent("Die Migration muss noch im Supabase Dashboard ausgef\xfchrt werden. Siehe Anleitung unten.")):(0,r.redirect)("/admin/settings/migrate?error="+encodeURIComponent(a.message)):(0,r.redirect)("/admin/settings?success="+encodeURIComponent("Migration erfolgreich! Sie k\xf6nnen jetzt beliebige Schicht-Namen verwenden."))}async function u({searchParams:e}){let t=(0,n.e)(),{data:{user:s}}=await t.auth.getUser();s||(0,r.redirect)("/login");let{data:a}=await t.from("memberships").select("station_id, role").eq("user_id",s.id).single();return a&&"ADMIN"===a.role?(0,i.jsxs)("div",{className:"py-8 px-6 max-w-4xl mx-auto",children:[(0,i.jsxs)("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Datenbank-Migration"}),i.jsx("p",{className:"text-muted-foreground",children:"Aktualisierung der Schicht-Vorlagen Struktur"})]}),e.error&&i.jsx(d.Zb,{className:"mb-6 border-destructive",children:i.jsx(d.aY,{className:"pt-6",children:i.jsx("p",{className:"text-destructive",children:e.error})})}),(0,i.jsxs)(d.Zb,{className:"mb-6",children:[(0,i.jsxs)(d.Ol,{children:[i.jsx(d.ll,{children:"Migration ausf\xfchren"}),i.jsx(d.SZ,{children:"Diese Migration erlaubt es Ihnen, Schicht-Vorlagen mit beliebigen Namen zu erstellen"})]}),(0,i.jsxs)(d.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[i.jsx("p",{className:"font-medium",children:"Was wird ge\xe4ndert?"}),(0,i.jsxs)("ul",{className:"list-disc list-inside text-sm space-y-1 ml-2",children:[i.jsx("li",{children:"Entfernt die Einschr\xe4nkung, dass nur 'DAY' und 'NIGHT' als Schicht-Namen erlaubt sind"}),i.jsx("li",{children:'Erm\xf6glicht beliebige Schicht-Namen (z.B. "Tagesdienst", "Nachtdienst", "Bereitschaft")'}),i.jsx("li",{children:"Beh\xe4lt die Unique-Constraint bei (keine Duplikate)"})]})]}),i.jsx("form",{action:o,children:i.jsx(l.z,{type:"submit",className:"w-full",children:"Migration durchf\xfchren"})}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[i.jsx("p",{className:"font-medium mb-2",children:"Falls die automatische Migration nicht funktioniert:"}),(0,i.jsxs)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[i.jsx("li",{children:"\xd6ffnen Sie das Supabase Dashboard"}),i.jsx("li",{children:"Gehen Sie zu SQL Editor"}),i.jsx("li",{children:"F\xfchren Sie folgendes SQL aus:"})]}),i.jsx("pre",{className:"mt-2 p-3 bg-muted rounded text-xs overflow-x-auto",children:`ALTER TABLE "public"."shift_templates"
DROP CONSTRAINT IF EXISTS "shift_templates_label_check";

ALTER TABLE "public"."shift_templates"
DROP CONSTRAINT IF EXISTS "shift_templates_station_id_label_key";

ALTER TABLE "public"."shift_templates"
ADD CONSTRAINT "shift_templates_station_id_label_key"
UNIQUE ("station_id", "label");`})]})]})]}),i.jsx("div",{className:"flex gap-4",children:i.jsx(c.default,{href:"/admin/settings",className:"flex-1",children:i.jsx(l.z,{variant:"outline",className:"w-full",children:"Zur\xfcck zu Einstellungen"})})})]}):i.jsx("div",{className:"py-8 px-6",children:(0,i.jsxs)(d.Zb,{className:"border-destructive",children:[i.jsx(d.Ol,{children:i.jsx(d.ll,{children:"Zugriff verweigert"})}),i.jsx(d.aY,{children:i.jsx("p",{children:"Sie ben\xf6tigen Administrator-Rechte."})})]})})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[276,374,702,582,559,369,4,863],()=>s(38053));module.exports=i})();