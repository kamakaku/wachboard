exports.id=916,exports.ids=[916],exports.modules={5646:(e,t,s)=>{let r={"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63":()=>Promise.resolve().then(s.bind(s,36523)).then(e=>e.createShift),"659765dc11ec3a57dc068050cea924c240e50f05":()=>Promise.resolve().then(s.bind(s,36523)).then(e=>e.updateShift),"926a037a3539bd2b228bd1f6c613d88928e0c6ef":()=>Promise.resolve().then(s.bind(s,36523)).then(e=>e.deleteShift),c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df:()=>Promise.resolve().then(s.bind(s,36523)).then(e=>e.duplicateShift),e04c74f5e7dd9916d243e6d59f930efd6e33927a:()=>Promise.resolve().then(s.bind(s,36523)).then(e=>e.updateShiftComplete),"224786e73ae99791ee2081514241c01b03d7e1f2":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.login),"2c667f50d9672450ffb9c7cc219224fdfd19874c":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.logout),"7aa99930817149a187f1a871bbaf702dea9ea495":()=>Promise.resolve().then(s.bind(s,83128)).then(e=>e.signup)};async function i(e,...t){return(await r[e]()).apply(null,t)}e.exports={"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63":i.bind(null,"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63"),"659765dc11ec3a57dc068050cea924c240e50f05":i.bind(null,"659765dc11ec3a57dc068050cea924c240e50f05"),"926a037a3539bd2b228bd1f6c613d88928e0c6ef":i.bind(null,"926a037a3539bd2b228bd1f6c613d88928e0c6ef"),c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df:i.bind(null,"c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df"),e04c74f5e7dd9916d243e6d59f930efd6e33927a:i.bind(null,"e04c74f5e7dd9916d243e6d59f930efd6e33927a"),"224786e73ae99791ee2081514241c01b03d7e1f2":i.bind(null,"224786e73ae99791ee2081514241c01b03d7e1f2"),"2c667f50d9672450ffb9c7cc219224fdfd19874c":i.bind(null,"2c667f50d9672450ffb9c7cc219224fdfd19874c"),"7aa99930817149a187f1a871bbaf702dea9ea495":i.bind(null,"7aa99930817149a187f1a871bbaf702dea9ea495")}},69461:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,79404,23)),Promise.resolve().then(s.bind(s,93663)),Promise.resolve().then(s.bind(s,55573)),Promise.resolve().then(s.bind(s,44794))},93663:(e,t,s)=>{"use strict";s.d(t,{ShiftAssignmentComplete:()=>v});var r=s(10326),i=s(17577),a=s(29752),n=s(50384),l=s(38443),d=s(3594),o=s(9280),c=s(44794),f=s(91664),u=s(41137),h=s(24061),p=s(87815),m=s(15601),g=s(45480),x=s(94019),b=s(43810);function v({vehicles:e,people:t,divisions:s,divisionId:v,initialAssignments:N,initialCopiedTrupps:j,initialPraktikantFlags:y,initialTruppPraktikantFlags:_}){let[k,w]=(0,i.useState)("all"),S=e=>"all"!==k&&s&&0!==s.length?e.filter(e=>!e.division_ids||0===e.division_ids.length||e.division_ids.includes(k)):e,$=S(t.filter(e=>!e.person_type||"MITARBEITER"===e.person_type)),T=S(t.filter(e=>"NOTARZT"===e.person_type)),D=S(t.filter(e=>"FUEHRUNGSDIENST"===e.person_type)),[I,O]=(0,i.useState)(N||{}),[P,C]=(0,i.useState)(j||{}),[z,E]=(0,i.useState)(y||{}),[F,R]=(0,i.useState)(_||{}),[Z,A]=(0,i.useState)(new Set),[U,q]=(0,i.useState)(null),[V,J]=(0,i.useState)(null),[K,L]=(0,i.useState)("mitarbeiter"),B=(e,t,s)=>{O(r=>({...r,[e]:{...r[e],[t]:s}}))},H=(e,s)=>{let r=I[e]?.[s];return r&&t.find(e=>e.id===r)||null},M=(e,s,r)=>{let i=t.find(t=>t.id===e);return!!i&&("__notarzt__"===r?"NOTARZT"===i.person_type:"__fuehrungsdienst__"===r?"FUEHRUNGSDIENST"===i.person_type:!i.person_type||"MITARBEITER"===i.person_type)},Y=(e,t)=>{let s=`${e}:${t}`;A(e=>new Set(e).add(s)),B(e,t,null)},W=(e,t)=>{let s=`${e}:${t}`;return Z.has(s)},G=(t,s,r)=>{if(!e.find(e=>e.id===s))return;let i=e.find(e=>e.id===t);if(!i)return;let a=i.config.trupps||[],n=r,l=2;for(;a.some(e=>e.key===n);)n=`${r} (${l})`,l++;C(e=>({...e,[t]:[...e[t]||[],{sourceVehicleId:s,sourceTruppKey:r,targetTruppKey:n}]}))},X=(e,t)=>{C(s=>({...s,[e]:(s[e]||[]).filter((e,s)=>s!==t)}))},Q=(e,t)=>{q(t),e.dataTransfer.effectAllowed="copy"},ee=(e,t,s)=>{J({vehicleId:t,truppKey:s}),e.dataTransfer.effectAllowed="copy"},et=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},es=(t,s,r)=>{t.preventDefault();let i=e.find(e=>e.id===s);U&&i&&M(U.id,i,r)&&B(s,r,U.id),q(null)},er=(e,t)=>{e.preventDefault(),V&&V.vehicleId!==t&&G(t,V.vehicleId,V.truppKey),J(null)};return console.log("ShiftAssignmentComplete render - assignments:",I),console.log("ShiftAssignmentComplete render - copiedTrupps:",P),console.log("ShiftAssignmentComplete render - praktikantFlags:",z),console.log("ShiftAssignmentComplete render - truppPraktikantFlags:",F),console.log("ShiftAssignmentComplete render - assignments JSON:",JSON.stringify(I)),console.log("ShiftAssignmentComplete render - copiedTrupps JSON:",JSON.stringify(P)),console.log("ShiftAssignmentComplete render - praktikantFlags JSON:",JSON.stringify(z)),console.log("ShiftAssignmentComplete render - truppPraktikantFlags JSON:",JSON.stringify(F)),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[r.jsx("div",{className:"col-span-3",children:(0,r.jsxs)(a.Zb,{className:"sticky top-4",children:[(0,r.jsxs)(a.Ol,{className:"pb-3",children:[r.jsx(a.ll,{className:"text-base",children:"Personalpool"}),r.jsx(a.SZ,{className:"text-xs",children:"Personen auf Positionen ziehen"}),s&&s.length>0&&(0,r.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,r.jsxs)(c.Label,{htmlFor:"division-filter",className:"text-xs flex items-center gap-1",children:[r.jsx(u.Z,{className:"h-3 w-3"}),"Nach Wachabteilung filtern"]}),(0,r.jsxs)("select",{id:"division-filter",value:k,onChange:e=>w(e.target.value),className:"w-full h-8 rounded-md border border-input bg-background px-2 text-xs",children:[r.jsx("option",{value:"all",children:"Alle anzeigen"}),s.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),r.jsx(a.aY,{className:"p-0",children:(0,r.jsxs)(n.Tabs,{value:K,onValueChange:L,children:[(0,r.jsxs)(n.TabsList,{className:"w-full grid grid-cols-3 rounded-none border-b",children:[(0,r.jsxs)(n.TabsTrigger,{value:"mitarbeiter",className:"text-xs",children:[r.jsx(h.Z,{className:"h-3 w-3 mr-1"}),$.length]}),(0,r.jsxs)(n.TabsTrigger,{value:"notarzt",className:"text-xs",children:[r.jsx(p.Z,{className:"h-3 w-3 mr-1"}),T.length]}),(0,r.jsxs)(n.TabsTrigger,{value:"fuehrungsdienst",className:"text-xs",children:[r.jsx(m.Z,{className:"h-3 w-3 mr-1"}),D.length]})]}),r.jsx(n.TabsContent,{value:K,className:"mt-0 p-3",children:r.jsx("div",{className:"space-y-1 max-h-[65vh] overflow-y-auto",children:(e=>{switch(e){case"notarzt":return T;case"fuehrungsdienst":return D;default:return $}})(K).map(e=>(0,r.jsxs)("div",{draggable:!0,onDragStart:t=>Q(t,e),className:"flex items-center gap-2 p-1.5 rounded border cursor-move hover:bg-muted/50 text-xs",children:[r.jsx(g.Z,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),r.jsx(d.q,{src:e.photo_url??void 0,name:e.name,size:20}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-medium truncate leading-tight",children:e.name}),e.rank&&r.jsx("p",{className:"text-[10px] text-muted-foreground leading-tight",children:e.rank})]}),e.tags&&e.tags.length>0&&r.jsx(l.C,{variant:"outline",className:"text-[10px] px-1 h-4",children:e.tags[0]})]},e.id))})})]})})]})}),r.jsx("div",{className:"col-span-9 space-y-6",children:e.map(t=>(0,r.jsxs)(a.Zb,{className:"border-2",onDragOver:et,onDrop:e=>er(e,t.id),children:[r.jsx(a.Ol,{className:"pb-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[t.image_url&&r.jsx("img",{src:t.image_url,alt:t.title,className:"w-16 h-16 object-cover rounded"}),(0,r.jsxs)("div",{children:[r.jsx(a.ll,{className:"text-lg",children:t.title}),r.jsx(a.SZ,{children:r.jsx("code",{className:"text-xs",children:t.key})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[t.config.hasNotarztPool&&(0,r.jsxs)(l.C,{variant:"outline",className:"bg-red-50",children:[r.jsx(p.Z,{className:"h-3 w-3 mr-1"}),"Notarzt"]}),t.config.hasFuehrungsdienstPool&&(0,r.jsxs)(l.C,{variant:"outline",className:"bg-blue-50",children:[r.jsx(m.Z,{className:"h-3 w-3 mr-1"}),"F\xfchrung"]}),t.config.allowsPraktikant&&(!t.config.trupps||0===t.config.trupps.length)&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(o.X,{id:`praktikant-${t.id}`,checked:z[t.id]||!1,onCheckedChange:e=>E(s=>({...s,[t.id]:!0===e}))}),r.jsx(c.Label,{htmlFor:`praktikant-${t.id}`,className:"text-sm cursor-pointer",children:"Praktikant mitfahrend"})]})]})]})}),(0,r.jsxs)(a.aY,{className:"space-y-4",children:[(t.config.hasNotarztPool||t.config.hasFuehrungsdienstPool)&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-semibold text-sm",children:"Spezial-Positionen"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[t.config.hasNotarztPool&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("label",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx(p.Z,{className:"h-3 w-3 text-red-600"}),"Notarzt"]}),r.jsx("div",{className:"min-h-[3rem] p-2 rounded border-2 border-dashed bg-red-50/50",onDragOver:et,onDrop:e=>{e.preventDefault(),U&&"NOTARZT"===U.person_type&&B(t.id,"__notarzt__",U.id),q(null)},children:(()=>{let e=H(t.id,"__notarzt__");return e?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.q,{src:e.photo_url??void 0,name:e.name,size:24}),r.jsx("span",{className:"text-xs font-medium flex-1 truncate",children:e.name}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(t.id,"__notarzt__",null),className:"h-6 w-6 p-0",children:r.jsx(x.Z,{className:"h-3 w-3"})})]}):r.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"Notarzt ziehen"})})()})]}),t.config.hasFuehrungsdienstPool&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("label",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx(m.Z,{className:"h-3 w-3 text-blue-600"}),"F\xfchrungsdienst"]}),r.jsx("div",{className:"min-h-[3rem] p-2 rounded border-2 border-dashed bg-blue-50/50",onDragOver:et,onDrop:e=>{e.preventDefault(),U&&"FUEHRUNGSDIENST"===U.person_type&&B(t.id,"__fuehrungsdienst__",U.id),q(null)},children:(()=>{let e=H(t.id,"__fuehrungsdienst__");return e?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.q,{src:e.photo_url??void 0,name:e.name,size:24}),r.jsx("span",{className:"text-xs font-medium flex-1 truncate",children:e.name}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(t.id,"__fuehrungsdienst__",null),className:"h-6 w-6 p-0",children:r.jsx(x.Z,{className:"h-3 w-3"})})]}):r.jsx("div",{className:"text-xs text-muted-foreground text-center py-2",children:"F\xfchrungsdienst ziehen"})})()})]})]})]}),P[t.id]&&P[t.id].length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[r.jsx(b.Z,{className:"h-4 w-4"}),"Kopierte Trupps"]}),P[t.id].map((s,i)=>{let a=e.find(e=>e.id===s.sourceVehicleId),n=a?.config.trupps?.find(e=>e.key===s.sourceTruppKey);return(0,r.jsxs)("div",{className:"border rounded-lg p-3 bg-green-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium",children:s.targetTruppKey}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Von ",a?.title," - ",s.sourceTruppKey]})]}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>X(t.id,i),children:r.jsx(x.Z,{className:"h-4 w-4"})})]}),n&&r.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.slots.map((e,t)=>{let i=`${s.sourceTruppKey}:${e}`,a=H(s.sourceVehicleId,i);return(0,r.jsxs)("div",{className:"space-y-1",onDragOver:et,onDrop:t=>{let r=`${s.sourceTruppKey}:${e}`;es(t,s.sourceVehicleId,r)},children:[r.jsx("label",{className:"text-[10px] text-muted-foreground",children:e}),r.jsx("div",{className:`min-h-[2.5rem] p-1.5 rounded border-2 border-dashed ${a?"bg-white border-primary":"bg-white border-muted-foreground/20"}`,children:a?(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx(d.q,{src:a.photo_url??void 0,name:a.name,size:20}),r.jsx("span",{className:"text-[11px] font-medium flex-1 truncate",children:a.name}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(s.sourceVehicleId,i,null),className:"h-5 w-5 p-0",children:r.jsx(x.Z,{className:"h-3 w-3"})})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full relative",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Ziehen"}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>{B(s.sourceVehicleId,i,null)},className:"h-4 w-4 p-0 absolute top-0 right-0",title:"Slot f\xfcr diesen Dienstplan ausblenden",children:r.jsx(x.Z,{className:"h-2.5 w-2.5 text-muted-foreground/50 hover:text-destructive"})})]})})]},t)})})]},i)})]}),t.config.trupps&&t.config.trupps.length>0&&r.jsx("div",{className:"space-y-3",children:t.config.trupps.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-muted/30",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 cursor-move select-none flex-1",draggable:!0,onDragStart:s=>{s.stopPropagation(),ee(s,t.id,e.key)},children:[r.jsx(g.Z,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("h4",{className:"font-semibold text-sm",children:e.key}),e.allowsPraktikant&&r.jsx(l.C,{variant:"outline",className:"text-xs",children:"+Praktikant"})]}),e.allowsPraktikant&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(o.X,{id:`trupp-praktikant-${t.id}-${e.key}`,checked:F[t.id]?.[e.key]||!1,onCheckedChange:s=>R(r=>({...r,[t.id]:{...r[t.id]||{},[e.key]:!0===s}}))}),r.jsx(c.Label,{htmlFor:`trupp-praktikant-${t.id}-${e.key}`,className:"text-xs cursor-pointer",children:"Praktikant"})]})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.slots.filter(s=>{let r=`${e.key}:${s}`;return!W(t.id,r)}).map(s=>{let i=`${e.key}:${s}`,a=H(t.id,i);return(0,r.jsxs)("div",{className:"space-y-1",onDragOver:et,onDrop:e=>es(e,t.id,i),children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:s}),r.jsx("div",{className:`min-h-[3rem] p-2 rounded border-2 border-dashed ${a?"bg-primary/5 border-primary":"border-muted-foreground/20"}`,children:a?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.q,{src:a.photo_url??void 0,name:a.name,size:24}),r.jsx("span",{className:"text-xs font-medium flex-1 truncate",children:a.name}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(t.id,i,null),className:"h-6 w-6 p-0",children:r.jsx(x.Z,{className:"h-3 w-3"})})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full relative py-2",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:"Person ziehen"}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y(t.id,i),className:"h-5 w-5 p-0 absolute top-1 right-1",title:"Slot f\xfcr diesen Dienstplan ausblenden",children:r.jsx(x.Z,{className:"h-3 w-3 text-muted-foreground/50 hover:text-destructive"})})]})})]},i)})})]},e.key))}),t.config.slots&&t.config.slots.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-semibold text-sm",children:"Einzelne Positionen"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.config.slots.filter(e=>!W(t.id,e)).map(e=>{let s=H(t.id,e);return(0,r.jsxs)("div",{className:"space-y-1",onDragOver:et,onDrop:s=>es(s,t.id,e),children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:e}),r.jsx("div",{className:`min-h-[3rem] p-2 rounded border-2 border-dashed ${s?"bg-primary/5 border-primary":"border-muted-foreground/20"}`,children:s?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.q,{src:s.photo_url??void 0,name:s.name,size:24}),r.jsx("span",{className:"text-xs font-medium flex-1 truncate",children:s.name}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(t.id,e,null),className:"h-6 w-6 p-0",children:r.jsx(x.Z,{className:"h-3 w-3"})})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full relative",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:"Person ziehen"}),r.jsx(f.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y(t.id,e),className:"h-5 w-5 p-0 absolute top-1 right-1",title:"Slot f\xfcr diesen Dienstplan ausblenden",children:r.jsx(x.Z,{className:"h-3 w-3 text-muted-foreground/50 hover:text-destructive"})})]})})]},e)})})]})]})]},t.id))})]}),r.jsx("input",{type:"hidden",name:"assignments",value:JSON.stringify(I),"data-debug":"assignments-input"}),r.jsx("input",{type:"hidden",name:"copiedTrupps",value:JSON.stringify(P),"data-debug":"trupps-input"}),r.jsx("input",{type:"hidden",name:"praktikantFlags",value:JSON.stringify(z),"data-debug":"praktikant-input"}),r.jsx("input",{type:"hidden",name:"truppPraktikantFlags",value:JSON.stringify(F),"data-debug":"trupp-praktikant-input"}),(0,r.jsxs)("div",{style:{display:"none"},"data-debug-assignments":JSON.stringify(I).substring(0,100),children:["Assignments count: ",Object.keys(I).length]})]})}},55573:(e,t,s)=>{"use strict";s.d(t,{ShiftTypeSelector:()=>h});var r=s(10326),i=s(17577),a=s(44794),n=s(41190),l=s(18623),d=s(53982),o=s(51223);let c=i.forwardRef(({className:e,...t},s)=>r.jsx(l.fC,{className:(0,o.cn)("grid gap-2",e),...t,ref:s}));c.displayName=l.fC.displayName;let f=i.forwardRef(({className:e,...t},s)=>r.jsx(l.ck,{ref:s,className:(0,o.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:r.jsx(l.z$,{className:"flex items-center justify-center",children:r.jsx(d.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})}));f.displayName=l.ck.displayName;var u=s(48998);function h({templates:e,defaultStartTime:t,defaultEndTime:s}){let l=t&&s?e.find(e=>e.start_time===t&&e.end_time===s):e[0],[d,o]=(0,i.useState)(l?.id||""),[h,p]=(0,i.useState)(t||l?.start_time||"07:00"),[m,g]=(0,i.useState)(s||l?.end_time||"19:00");return 0===e.length?(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"p-4 bg-muted rounded-lg text-center",children:r.jsx("p",{className:"text-sm text-muted-foreground",children:"Keine Schicht-Vorlagen vorhanden. Erstellen Sie zuerst Vorlagen in den Einstellungen."})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[r.jsx(a.Label,{htmlFor:"shift-start",children:"Beginn *"}),r.jsx(n.I,{id:"shift-start",name:"start_time",type:"time",required:!0,defaultValue:t||"07:00"})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[r.jsx(a.Label,{htmlFor:"shift-end",children:"Ende *"}),r.jsx(n.I,{id:"shift-end",name:"end_time",type:"time",required:!0,defaultValue:s||"19:00"})]})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid gap-3",children:[r.jsx(a.Label,{children:"Schichtvorlage *"}),r.jsx(c,{value:d,onValueChange:t=>{let s=e.find(e=>e.id===t);s&&(o(t),p(s.start_time),g(s.end_time))},className:"grid grid-cols-2 gap-4",children:e.map(e=>(0,r.jsxs)("div",{children:[r.jsx(f,{value:e.id,id:`shift-type-${e.id}`,className:"peer sr-only"}),(0,r.jsxs)(a.Label,{htmlFor:`shift-type-${e.id}`,className:"flex flex-col items-center justify-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer",children:[r.jsx(u.Z,{className:"mb-2 h-6 w-6"}),r.jsx("span",{className:"font-semibold",children:e.label}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground mt-1",children:[e.start_time," - ",e.end_time]})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[r.jsx(a.Label,{htmlFor:"shift-start",children:"Beginn *"}),r.jsx(n.I,{id:"shift-start",name:"start_time",type:"time",required:!0,value:h,onChange:e=>p(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[r.jsx(a.Label,{htmlFor:"shift-end",children:"Ende *"}),r.jsx(n.I,{id:"shift-end",name:"end_time",type:"time",required:!0,value:m,onChange:e=>g(e.target.value)})]})]})]})}},3594:(e,t,s)=>{"use strict";s.d(t,{q:()=>n});var r=s(10326),i=s(46226),a=s(51223);function n({src:e,name:t,size:s=36,className:n}){let l=t?t.split(" ").filter(Boolean).map(e=>e[0]).slice(0,2).join("").toUpperCase():"";return r.jsx("div",{className:(0,a.cn)("relative overflow-hidden rounded-full bg-muted text-muted-foreground/70 flex items-center justify-center border border-border flex-shrink-0",n),style:{width:s,height:s},children:e?r.jsx(i.default,{src:e,alt:t??"Avatar",width:s,height:s,className:"object-cover w-full h-full",unoptimized:!0}):r.jsx("span",{style:{fontSize:.4*s},className:"font-semibold",children:l||"?"})})}},38443:(e,t,s)=>{"use strict";s.d(t,{C:()=>l});var r=s(10326);s(17577);var i=s(79360),a=s(51223);let n=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...s}){return r.jsx("div",{className:(0,a.cn)(n({variant:t}),e),...s})}},29752:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>l,SZ:()=>o,Zb:()=>n,aY:()=>c,ll:()=>d});var r=s(10326),i=s(17577),a=s(51223);let n=i.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));n.displayName="Card";let l=i.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let d=i.forwardRef(({className:e,...t},s)=>r.jsx("h3",{ref:s,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));d.displayName="CardTitle";let o=i.forwardRef(({className:e,...t},s)=>r.jsx("p",{ref:s,className:(0,a.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let c=i.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,a.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent",i.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,a.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},9280:(e,t,s)=>{"use strict";s.d(t,{X:()=>d});var r=s(10326),i=s(17577),a=s(13635),n=s(32933),l=s(51223);let d=i.forwardRef(({className:e,...t},s)=>r.jsx(a.fC,{ref:s,className:(0,l.cn)("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:r.jsx(a.z$,{className:(0,l.cn)("grid place-content-center text-current"),children:r.jsx(n.Z,{className:"h-4 w-4"})})}));d.displayName=a.fC.displayName},41190:(e,t,s)=>{"use strict";s.d(t,{I:()=>n});var r=s(10326),i=s(17577),a=s(51223);let n=i.forwardRef(({className:e,type:t,...s},i)=>r.jsx("input",{type:t,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...s}));n.displayName="Input"},44794:(e,t,s)=>{"use strict";s.d(t,{Label:()=>o});var r=s(10326),i=s(17577),a=s(29152),n=s(79360),l=s(51223);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=i.forwardRef(({className:e,...t},s)=>r.jsx(a.f,{ref:s,className:(0,l.cn)(d(),e),...t}));o.displayName=a.f.displayName},50384:(e,t,s)=>{"use strict";s.d(t,{Tabs:()=>l,TabsContent:()=>c,TabsList:()=>d,TabsTrigger:()=>o});var r=s(10326),i=s(17577),a=s(28407),n=s(51223);let l=a.fC,d=i.forwardRef(({className:e,...t},s)=>r.jsx(a.aV,{ref:s,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));d.displayName=a.aV.displayName;let o=i.forwardRef(({className:e,...t},s)=>r.jsx(a.xz,{ref:s,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));o.displayName=a.xz.displayName;let c=i.forwardRef(({className:e,...t},s)=>r.jsx(a.VY,{ref:s,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));c.displayName=a.VY.displayName},36974:(e,t,s)=>{"use strict";s.d(t,{s:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/admin/shift-assignment-complete.tsx#ShiftAssignmentComplete`)},25544:(e,t,s)=>{"use strict";s.d(t,{V:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/admin/shift-type-selector.tsx#ShiftTypeSelector`)},49922:(e,t,s)=>{"use strict";s.d(t,{I:()=>n});var r=s(19510),i=s(71159),a=s(40644);let n=i.forwardRef(({className:e,type:t,...s},i)=>r.jsx("input",{type:t,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...s}));n.displayName="Input"},40278:(e,t,s)=>{"use strict";s.d(t,{_:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/label.tsx#Label`)},36523:(e,t,s)=>{"use strict";s.r(t),s.d(t,{createShift:()=>l,deleteShift:()=>f,duplicateShift:()=>c,updateShift:()=>d,updateShiftComplete:()=>o});var r=s(24330);s(60166);var i=s(65655),a=s(57708),n=s(58585);async function l(e){let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();if(!s)throw console.error("User not authenticated"),Error("User not authenticated.");let r=e.get("date"),l=e.get("start_time"),d=e.get("end_time"),o=e.get("division_id");console.log("Form data:",{date:r,start_time:l,end_time:d,division_id:o,wachleitung_im_haus:"on"===e.get("wachleitung_im_haus")});let c=e.get("assignments"),f=e.get("copiedTrupps"),u=e.get("praktikantFlags");if(!r||!l||!d||!o)return console.error("Missing required fields:",{date:r,start_time:l,end_time:d,division_id:o}),(0,n.redirect)("/app/shifts/new?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.");let h={};try{h=c?JSON.parse(c):{},f&&JSON.parse(f),u&&JSON.parse(u)}catch(e){return console.error("Error parsing JSON data:",e),(0,n.redirect)("/app/shifts/new?error=Fehler beim Verarbeiten der Zuweisungen.")}let{data:p}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",s.id).single();if(!p||!["ADMIN","EDITOR"].includes(p.role))return(0,n.redirect)("/app/shifts/new?error=Keine Berechtigung.");let{data:m}=await t.from("divisions").select("id, station_id").eq("id",o).single();if(!m||m.station_id!==p.station_id)return(0,n.redirect)("/app/shifts/new?error=Ung\xfcltige Wachabteilung.");if("EDITOR"===p.role&&!(p.division_ids||[]).includes(o))return(0,n.redirect)("/app/shifts/new?error=Sie haben keinen Zugriff auf diese Division.");let g=e=>{let t=e.split(":");return`${t[0]}:${t[1]}`},x=`${r}T${g(l)}:00`,b=`${r}T${g(d)}:00`;if(g(d)<=g(l)){let e=new Date(`${r}T${g(d)}:00`);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];b=`${t}T${g(d)}:00`}console.log("Raw times:",{start_time:l,end_time:d}),console.log("Timestamps:",{starts_at:x,ends_at:b});let v=parseInt(l.split(":")[0]),{data:N,error:j}=await t.from("shifts").insert({station_id:p.station_id,division_id:o,starts_at:x,ends_at:b,label:v>=7&&v<19?"DAY":"NIGHT",status:"PUBLISHED"}).select().single();if(j)return(console.error("Error creating shift:",j),console.error("Error details:",JSON.stringify(j,null,2)),"23505"===j.code)?(0,n.redirect)(`/app/shifts/new?error=${encodeURIComponent("Es existiert bereits eine Schicht f\xfcr diese Wachabteilung zu dieser Startzeit.")}`):(0,n.redirect)(`/app/shifts/new?error=${encodeURIComponent("Fehler beim Erstellen der Schicht: "+j.message)}`);console.log("Shift created successfully:",N);let y=[];for(let[e,r]of Object.entries(h))for(let[i,a]of Object.entries(r))if(a){let{data:r}=await t.from("vehicle_configs").select("key").eq("id",e).single();r&&y.push({shift_id:N.id,vehicle_key:r.key,slot_key:i,person_id:a,updated_by:s.id})}if(y.length>0){let{error:e}=await t.from("assignments").insert(y);e&&console.error("Error creating assignments:",e)}(0,a.revalidatePath)("/app/shifts"),(0,n.redirect)("/app/shifts?success=Schicht erfolgreich erstellt.")}async function d(e){let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();if(!s)throw console.error("User not authenticated"),Error("User not authenticated.");let r=e.get("shiftId"),l=e.get("date"),d=e.get("start_time"),o=e.get("end_time"),c=e.get("label")?.trim()??null,f=e.get("status")??"PUBLISHED";if(!r||!l||!d||!o)return(0,n.redirect)("/app/shifts?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.");let u=e=>{let t=e.split(":");return`${t[0]}:${t[1]??"00"}`},h=`${l}T${u(d)}:00`,p=`${l}T${u(o)}:00`;if(new Date(p)<=new Date(h)){let e=new Date(p);e.setDate(e.getDate()+1),p=e.toISOString().slice(0,19)}let{error:m}=await t.from("shifts").update({starts_at:h,ends_at:p,label:c,status:f}).eq("id",r);if(m)return console.error("Error updating shift:",m),(0,n.redirect)(`/app/shifts?error=${encodeURIComponent("Fehler beim Aktualisieren der Schicht.")}`);(0,a.revalidatePath)("/app/shifts"),(0,n.redirect)("/app/shifts?success=Schicht erfolgreich aktualisiert.")}async function o(e){console.log("====================================================="),console.log("updateShiftComplete called!"),console.log("FormData keys:",Array.from(e.keys())),console.log("=====================================================");let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();if(!s)throw console.error("User not authenticated"),Error("User not authenticated.");let r=e.get("shift_id"),l=e.get("date"),d=e.get("start_time"),o=e.get("end_time"),c=e.get("division_id"),f="on"===e.get("wachleitung_im_haus");console.log("Basic form data:",{shift_id:r,date:l,start_time:d,end_time:o,division_id:c,wachleitung_im_haus:f});let u=e.get("assignments"),h=e.get("copiedTrupps"),p=e.get("praktikantFlags"),m=e.get("truppPraktikantFlags");if(!r||!l||!d||!o||!c)return(0,n.redirect)(`/app/shifts/${r}/edit?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.`);let g={},x={},b={},v={};console.log("Raw JSON from form:",{assignmentsJson:u,copiedTruppsJson:h,praktikantFlagsJson:p,truppPraktikantFlagsJson:m});try{g=u?JSON.parse(u):{},x=h?JSON.parse(h):{},b=p?JSON.parse(p):{},v=m?JSON.parse(m):{},console.log("Parsed assignments:",g),console.log("Parsed copiedTrupps:",x),console.log("Parsed praktikantFlags:",b),console.log("Parsed truppPraktikantFlags:",v)}catch(e){return console.error("Error parsing JSON data:",e),(0,n.redirect)(`/app/shifts/${r}/edit?error=Fehler beim Verarbeiten der Zuweisungen.`)}let{data:N}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",s.id).single();if(!N||!["ADMIN","EDITOR"].includes(N.role))return(0,n.redirect)(`/app/shifts/${r}/edit?error=Keine Berechtigung.`);let{data:j}=await t.from("shifts").select("id, station_id, division_id").eq("id",r).single();if(!j||j.station_id!==N.station_id)return(0,n.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===N.role&&!(N.division_ids||[]).includes(j.division_id))return(0,n.redirect)(`/app/shifts/${r}/edit?error=Sie haben keinen Zugriff auf diese Division.`);let{data:y}=await t.from("divisions").select("id, station_id").eq("id",c).single();if(!y||y.station_id!==N.station_id)return(0,n.redirect)(`/app/shifts/${r}/edit?error=Ung\xfcltige Wachabteilung.`);if("EDITOR"===N.role&&c!==j.division_id&&!(N.division_ids||[]).includes(c))return(0,n.redirect)(`/app/shifts/${r}/edit?error=Sie haben keinen Zugriff auf die neue Division.`);let _=e=>{let t=e.split(":");return`${t[0]}:${t[1]}`},k=`${l}T${_(d)}:00`,w=`${l}T${_(o)}:00`;if(_(o)<=_(d)){let e=new Date(`${l}T${_(o)}:00`);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];w=`${t}T${_(o)}:00`}console.log("Updating shift:",{shift_id:r,starts_at:k,ends_at:w});let S=parseInt(d.split(":")[0]),{error:$}=await t.from("shifts").update({division_id:c,starts_at:k,ends_at:w,label:S>=7&&S<19?"DAY":"NIGHT",wachleitung_im_haus:f}).eq("id",r);if($)return console.error("Error updating shift:",$),(0,n.redirect)(`/app/shifts/${r}/edit?error=${encodeURIComponent("Fehler beim Aktualisieren der Schicht: "+$.message)}`);console.log("Shift updated successfully"),await t.from("assignments").delete().eq("shift_id",r);let T=[];console.log("Processing assignments. Total vehicles:",Object.keys(g).length),console.log("Processing copiedTrupps:",x),console.log("Processing praktikantFlags:",b);let{data:D}=await t.from("vehicle_configs").select("id, key, config").eq("station_id",N.station_id),I=new Map,O=new Map;D?.forEach(e=>{I.set(e.id,e.key),O.set(e.key,e.id)});let P=new Set;for(let[e,t]of Object.entries(x))for(let s of t)if(I.get(e)){let t=D?.find(e=>e.id===s.sourceVehicleId),r=t?.config?.trupps?.find(e=>e.key===s.sourceTruppKey);if(r?.slots)for(let t of r.slots){let r=`${s.targetTruppKey}:${t}`;P.add(`${e}:${r}`)}}for(let[e,t]of Object.entries(g)){let i=I.get(e);if(!i){console.error(`Vehicle not found for ID: ${e}`);continue}for(let[a,n]of(console.log(`Vehicle ${i} has ${Object.keys(t).length} slot assignments`),Object.entries(t))){let t=`${e}:${a}`;if(P.has(t)){console.log(`  - Skipping slot ${a} (belongs to copied trupp)`);continue}n&&(console.log(`  - Slot ${a}: Person ${n}`),T.push({shift_id:r,vehicle_key:i,slot_key:a,person_id:n,updated_by:s.id}))}}for(let[e,t]of Object.entries(x)){let i=I.get(e);if(!i){console.error(`Target vehicle not found for ID: ${e}`);continue}for(let e of t){let t=I.get(e.sourceVehicleId);if(!t){console.error(`Source vehicle not found for ID: ${e.sourceVehicleId}`);continue}for(let[a,n]of(console.log(`Processing copied trupp: ${e.sourceTruppKey} from ${t} to ${i} as ${e.targetTruppKey}`),Object.entries(g[e.sourceVehicleId]||{})))if("string"==typeof a&&a.startsWith(`${e.sourceTruppKey}:`)){let t=a.split(":")[1],l=`${e.targetTruppKey}:${t}`;n&&(console.log(`  - Copying ${a} to ${l} on ${i} with person ${n}`),T.push({shift_id:r,vehicle_key:i,slot_key:l,person_id:n,from_trupp_key:e.sourceTruppKey,updated_by:s.id}))}}}for(let[e,t]of Object.entries(b))if(t){let t=I.get(e);if(!t){console.error(`Vehicle not found for praktikant flag: ${e}`);continue}console.log(`Vehicle ${t} has praktikant flag set`),T.some(e=>e.vehicle_key===t&&("Praktikant"===e.slot_key||e.slot_key.toLowerCase().includes("praktikant")))||(T.push({shift_id:r,vehicle_key:t,slot_key:"Praktikant",person_id:null,placeholder_text:"Praktikant",updated_by:s.id}),console.log(`  - Added praktikant placeholder for ${t}`))}for(let[e,t]of Object.entries(v)){let i=I.get(e);if(!i){console.error(`Vehicle not found for trupp praktikant flags: ${e}`);continue}for(let[e,a]of Object.entries(t))if(a){console.log(`Trupp ${e} on vehicle ${i} has praktikant flag set`);let t=`${e}:Praktikant`;T.some(e=>e.vehicle_key===i&&e.slot_key===t)||(T.push({shift_id:r,vehicle_key:i,slot_key:t,person_id:null,placeholder_text:"Praktikant",updated_by:s.id}),console.log(`  - Added praktikant placeholder for trupp ${e} on ${i}`))}}if(console.log("Total assignment records to insert:",T.length),console.log("Assignment records:",T),T.length>0){let{error:e}=await t.from("assignments").insert(T);e?(console.error("Error creating assignments:",e),console.error("Assignment error details:",JSON.stringify(e,null,2))):console.log("Assignments created successfully!")}else console.log("No assignments to insert.");(0,a.revalidatePath)("/app/shifts"),(0,a.revalidatePath)(`/app/shifts/${r}/edit`),(0,n.redirect)("/app/shifts?success=Schicht erfolgreich aktualisiert.")}async function c(e){let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();if(!s)throw Error("User not authenticated.");let r=e.get("shiftId");if(!r)return(0,n.redirect)("/app/shifts?error=Keine Schicht-ID angegeben.");let{data:l}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",s.id).single();if(!l||!["ADMIN","EDITOR"].includes(l.role))return(0,n.redirect)("/app/shifts?error=Keine Berechtigung.");let{data:d,error:o}=await t.from("shifts").select(`
            *,
            assignments:assignments(vehicle_key, slot_key, person_id, from_trupp_key, placeholder_text)
        `).eq("id",r).eq("station_id",l.station_id).single();if(o||!d)return(0,n.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===l.role&&!(l.division_ids||[]).includes(d.division_id))return(0,n.redirect)("/app/shifts?error=Sie haben keinen Zugriff auf diese Division.");let c=new Date().toISOString().split("T")[0],f=new Date(d.starts_at),u=new Date(d.ends_at),h=`${String(f.getHours()).padStart(2,"0")}:${String(f.getMinutes()).padStart(2,"0")}`,p=`${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`,m=`${c}T${h}:00`,g=`${c}T${p}:00`;if(p<=h){let e=new Date(c);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];g=`${t}T${p}:00`}let{data:x,error:b}=await t.from("shifts").insert({station_id:d.station_id,division_id:d.division_id,starts_at:m,ends_at:g,label:d.label,status:"PUBLISHED",wachleitung_im_haus:d.wachleitung_im_haus}).select().single();if(b||!x)return(console.error("Error duplicating shift:",b),b?.code==="23505")?(0,n.redirect)(`/app/shifts?error=${encodeURIComponent("Es existiert bereits eine Schicht f\xfcr diese Wachabteilung zu dieser Startzeit.")}`):(0,n.redirect)(`/app/shifts?error=${encodeURIComponent("Fehler beim Duplizieren der Schicht.")}`);if(d.assignments&&d.assignments.length>0){let e=d.assignments.map(e=>({shift_id:x.id,vehicle_key:e.vehicle_key,slot_key:e.slot_key,person_id:e.person_id,from_trupp_key:e.from_trupp_key,placeholder_text:e.placeholder_text,updated_by:s.id})),{error:r}=await t.from("assignments").insert(e);r&&console.error("Error copying assignments:",r)}(0,a.revalidatePath)("/app/shifts"),(0,n.redirect)("/app/shifts?success=Schicht erfolgreich dupliziert.")}async function f(e){let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();if(!s)throw Error("User not authenticated.");let r=e.get("shiftId");if(!r)return(0,n.redirect)("/app/shifts?error=Keine Schicht-ID angegeben.");let{data:l}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",s.id).single();if(!l||!["ADMIN","EDITOR"].includes(l.role))return(0,n.redirect)("/app/shifts?error=Keine Berechtigung.");let{data:d,error:o}=await t.from("shifts").select("id, station_id, division_id").eq("id",r).eq("station_id",l.station_id).single();if(o||!d)return(0,n.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===l.role&&!(l.division_ids||[]).includes(d.division_id))return(0,n.redirect)("/app/shifts?error=Sie haben keinen Zugriff auf diese Division.");await t.from("assignments").delete().eq("shift_id",r);let{error:c}=await t.from("shifts").delete().eq("id",r);if(c)return console.error("Error deleting shift:",c),(0,n.redirect)("/app/shifts?error=Fehler beim L\xf6schen der Schicht.");(0,a.revalidatePath)("/app/shifts"),(0,n.redirect)("/app/shifts?success=Schicht erfolgreich gel\xf6scht.")}(0,s(40618).h)([l,d,o,c,f]),(0,r.j)("3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63",l),(0,r.j)("659765dc11ec3a57dc068050cea924c240e50f05",d),(0,r.j)("e04c74f5e7dd9916d243e6d59f930efd6e33927a",o),(0,r.j)("c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df",c),(0,r.j)("926a037a3539bd2b228bd1f6c613d88928e0c6ef",f)}};