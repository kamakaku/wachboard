(()=>{var e={};e.id=227,e.ids=[227],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39292:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>u,originalPathname:()=>f,pages:()=>c,routeModule:()=>h,tree:()=>l}),r(44427),r(88834),r(41611),r(35866),r(32029);var i=r(23191),s=r(88716),n=r(37922),a=r.n(n),o=r(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let l=["",{children:["(main)",{children:["app",{children:["shifts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,44427)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/shifts/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,88834)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,41611)),"/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,32029)),"/Users/kamakaku/_desiqn/__wachboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kamakaku/_desiqn/__wachboard/src/app/(main)/app/shifts/page.tsx"],f="/(main)/app/shifts/page",u={require:r,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(main)/app/shifts/page",pathname:"/app/shifts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},11187:(e,t,r)=>{let i={"224786e73ae99791ee2081514241c01b03d7e1f2":()=>Promise.resolve().then(r.bind(r,83128)).then(e=>e.login),"2c667f50d9672450ffb9c7cc219224fdfd19874c":()=>Promise.resolve().then(r.bind(r,83128)).then(e=>e.logout),"7aa99930817149a187f1a871bbaf702dea9ea495":()=>Promise.resolve().then(r.bind(r,83128)).then(e=>e.signup)};async function s(e,...t){return(await i[e]()).apply(null,t)}e.exports={"224786e73ae99791ee2081514241c01b03d7e1f2":s.bind(null,"224786e73ae99791ee2081514241c01b03d7e1f2"),"2c667f50d9672450ffb9c7cc219224fdfd19874c":s.bind(null,"2c667f50d9672450ffb9c7cc219224fdfd19874c"),"7aa99930817149a187f1a871bbaf702dea9ea495":s.bind(null,"7aa99930817149a187f1a871bbaf702dea9ea495")}},75519:(e,t,r)=>{let i={"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63":()=>Promise.resolve().then(r.bind(r,42890)).then(e=>e.createShift),"659765dc11ec3a57dc068050cea924c240e50f05":()=>Promise.resolve().then(r.bind(r,42890)).then(e=>e.updateShift),"926a037a3539bd2b228bd1f6c613d88928e0c6ef":()=>Promise.resolve().then(r.bind(r,42890)).then(e=>e.deleteShift),c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df:()=>Promise.resolve().then(r.bind(r,42890)).then(e=>e.duplicateShift),e04c74f5e7dd9916d243e6d59f930efd6e33927a:()=>Promise.resolve().then(r.bind(r,42890)).then(e=>e.updateShiftComplete)};async function s(e,...t){return(await i[e]()).apply(null,t)}e.exports={"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63":s.bind(null,"3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63"),"659765dc11ec3a57dc068050cea924c240e50f05":s.bind(null,"659765dc11ec3a57dc068050cea924c240e50f05"),"926a037a3539bd2b228bd1f6c613d88928e0c6ef":s.bind(null,"926a037a3539bd2b228bd1f6c613d88928e0c6ef"),c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df:s.bind(null,"c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df"),e04c74f5e7dd9916d243e6d59f930efd6e33927a:s.bind(null,"e04c74f5e7dd9916d243e6d59f930efd6e33927a")}},5109:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,79404,23)),Promise.resolve().then(r.bind(r,27245)),Promise.resolve().then(r.bind(r,50384))},43810:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let i=(0,r(62881).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},15919:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let i=(0,r(62881).Z)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},98091:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let i=(0,r(62881).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},27245:(e,t,r)=>{"use strict";r.d(t,{ShiftActions:()=>m});var i=r(10326),s=r(91664);let n=(0,r(62881).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);var a=r(43810),o=r(98091),d=r(90434),l=r(10143);r(15424);var c=r(46242),f=(0,c.$)("926a037a3539bd2b228bd1f6c613d88928e0c6ef");(0,c.$)("3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63"),(0,c.$)("659765dc11ec3a57dc068050cea924c240e50f05"),(0,c.$)("e04c74f5e7dd9916d243e6d59f930efd6e33927a");var u=(0,c.$)("c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df"),h=r(15919),p=r(17577),g=r(85999);function m({shiftId:e,hasEditAccess:t,shift:r}){let[c,m]=(0,p.useTransition)();return(0,i.jsxs)(l.DropdownMenu,{children:[i.jsx(l.DropdownMenuTrigger,{asChild:!0,children:i.jsx(s.z,{variant:"ghost",size:"sm",children:i.jsx(h.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(l.DropdownMenuContent,{align:"end",children:[t?i.jsx(l.DropdownMenuItem,{asChild:!0,children:(0,i.jsxs)(d.default,{href:`/app/shifts/${e}/edit`,children:[i.jsx(n,{className:"h-4 w-4 mr-2"}),"Bearbeiten"]})}):(0,i.jsxs)(l.DropdownMenuItem,{disabled:!0,children:[i.jsx(n,{className:"h-4 w-4 mr-2"}),"Bearbeiten"]}),(0,i.jsxs)(l.DropdownMenuItem,{onClick:()=>{m(async()=>{let t=new FormData;t.append("shiftId",e);try{await u(t),g.Am.success("Schicht erfolgreich dupliziert!")}catch(e){g.Am.error("Fehler beim Duplizieren der Schicht")}})},disabled:c,children:[i.jsx(a.Z,{className:"h-4 w-4 mr-2"}),"Duplizieren"]}),i.jsx(l.DropdownMenuSeparator,{}),t?(0,i.jsxs)(l.DropdownMenuItem,{onClick:()=>{confirm("Sind Sie sicher, dass Sie diese Schicht l\xf6schen m\xf6chten? Diese Aktion kann nicht r\xfcckg\xe4ngig gemacht werden.")&&m(async()=>{let t=new FormData;t.append("shiftId",e);try{await f(t),g.Am.success("Schicht erfolgreich gel\xf6scht!")}catch(e){g.Am.error("Fehler beim L\xf6schen der Schicht")}})},disabled:c,className:"text-destructive focus:text-destructive",children:[i.jsx(o.Z,{className:"h-4 w-4 mr-2"}),"L\xf6schen"]}):(0,i.jsxs)(l.DropdownMenuItem,{disabled:!0,className:"text-destructive",children:[i.jsx(o.Z,{className:"h-4 w-4 mr-2"}),"L\xf6schen"]})]})]})}},50384:(e,t,r)=>{"use strict";r.d(t,{Tabs:()=>o,TabsContent:()=>c,TabsList:()=>d,TabsTrigger:()=>l});var i=r(10326),s=r(17577),n=r(28407),a=r(51223);let o=n.fC,d=s.forwardRef(({className:e,...t},r)=>i.jsx(n.aV,{ref:r,className:(0,a.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));d.displayName=n.aV.displayName;let l=s.forwardRef(({className:e,...t},r)=>i.jsx(n.xz,{ref:r,className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));l.displayName=n.xz.displayName;let c=s.forwardRef(({className:e,...t},r)=>i.jsx(n.VY,{ref:r,className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));c.displayName=n.VY.displayName},74739:(e,t,r)=>{"use strict";var i=r(25649);r.o(i,"redirect")&&r.d(t,{redirect:function(){return i.redirect}})},25649:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return a},RedirectType:function(){return i.RedirectType},notFound:function(){return s.notFound},permanentRedirect:function(){return i.permanentRedirect},redirect:function(){return i.redirect}});let i=r(12863),s=r(722);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class a extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return s},notFound:function(){return i}});let r="NEXT_NOT_FOUND";function i(){let e=Error(r);throw e.digest=r,e}function s(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},13809:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},12863:(e,t,r)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return i},getRedirectError:function(){return d},getRedirectStatusCodeFromError:function(){return p},getRedirectTypeFromError:function(){return h},getURLFromRedirectError:function(){return u},isRedirectError:function(){return f},permanentRedirect:function(){return c},redirect:function(){return l}});let s=r(54580),n=r(72934),a=r(13809),o="NEXT_REDIRECT";function d(e,t,r){void 0===r&&(r=a.RedirectStatusCode.TemporaryRedirect);let i=Error(o);i.digest=o+";"+t+";"+e+";"+r+";";let n=s.requestAsyncStorage.getStore();return n&&(i.mutableCookies=n.mutableCookies),i}function l(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?a.RedirectStatusCode.SeeOther:a.RedirectStatusCode.TemporaryRedirect)}function c(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?a.RedirectStatusCode.SeeOther:a.RedirectStatusCode.PermanentRedirect)}function f(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,i,s]=e.digest.split(";",4),n=Number(s);return t===o&&("replace"===r||"push"===r)&&"string"==typeof i&&!isNaN(n)&&n in a.RedirectStatusCode}function u(e){return f(e)?e.digest.split(";",3)[2]:null}function h(e){if(!f(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function p(e){if(!f(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(i||(i={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},44427:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var i=r(19510),s=r(65655),n=r(58585),a=r(57371),o=r(27039),d=r(93804),l=r(75782),c=r(59558),f=r(94725);let u=(0,r(68570).createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/admin/shift-actions.tsx#ShiftActions`);async function h({searchParams:e}){let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();r||(0,n.redirect)("/login");let{data:h}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",r.id).single();if(!h||!["ADMIN","EDITOR"].includes(h.role))return i.jsx("div",{className:"py-8 px-6",children:(0,i.jsxs)(d.Zb,{className:"border-destructive",children:[i.jsx(d.Ol,{children:i.jsx(d.ll,{children:"Zugriff verweigert"})}),i.jsx(d.aY,{children:i.jsx("p",{children:"Sie ben\xf6tigen Editor- oder Administrator-Rechte."})})]})});let{data:p,error:g}=await t.from("shifts").select(`
        *,
        division:divisions(id, name, color),
        assignments:assignments(id, vehicle_key)
      `).eq("station_id",h.station_id).order("starts_at",{ascending:!0});g&&console.error("Error fetching shifts:",g);let m=h.division_ids||[],b=e=>"ADMIN"===h.role||m.includes(e),_=new Date,x=new Date(_.getFullYear(),_.getMonth(),_.getDate()),y=p?.filter(e=>new Date(e.starts_at)>=x)||[],v=p?.filter(e=>new Date(e.starts_at)<x)||[];y.sort((e,t)=>new Date(e.starts_at).getTime()-new Date(t.starts_at).getTime()),v.sort((e,t)=>new Date(t.starts_at).getTime()-new Date(e.starts_at).getTime());let j=e=>{let[t,r]=e.split("T"),[i,s,n]=t.split("-"),[a,o]=r.split(":");return`${n}.${s}.${i.slice(2)}, ${a}:${o}`},w=e=>{let[t,r]=e.split("T")[1].split(":");return`${t}:${r}`},k=e=>{let t=b(e.division_id);return(0,i.jsxs)(l.SC,{children:[(0,i.jsxs)(l.pj,{children:[j(e.starts_at)," - ",w(e.ends_at)]}),i.jsx(l.pj,{children:e.division?.name}),i.jsx(l.pj,{children:i.jsx(c.C,{variant:"secondary",children:e.assignments?.length||0})}),i.jsx(l.pj,{children:i.jsx(c.C,{children:e.status})}),i.jsx(l.pj,{children:i.jsx(u,{shiftId:e.id,hasEditAccess:t,shift:e})})]},e.id)};return(0,i.jsxs)("div",{className:"py-8 px-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsxs)("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Dienstplan"}),i.jsx("p",{className:"text-muted-foreground",children:"\xdcbersicht und Verwaltung aller Dienstpl\xe4ne"})]}),i.jsx(a.default,{href:"/app/shifts/new",children:i.jsx(o.z,{children:"Neue Schicht erstellen"})})]}),e.error&&i.jsx(d.Zb,{className:"mb-6 border-destructive",children:i.jsx(d.aY,{className:"pt-6",children:i.jsx("p",{className:"text-destructive",children:e.error})})}),e.success&&i.jsx(d.Zb,{className:"mb-6 border-green-500",children:i.jsx(d.aY,{className:"pt-6",children:i.jsx("p",{className:"text-green-600",children:e.success})})}),(0,i.jsxs)(f.mQ,{defaultValue:"current",className:"w-full",children:[(0,i.jsxs)(f.dr,{className:"grid w-full max-w-md grid-cols-2 mb-4",children:[(0,i.jsxs)(f.SP,{value:"current",children:["Aktuell (",y.length,")"]}),(0,i.jsxs)(f.SP,{value:"past",children:["Vergangen (",v.length,")"]})]}),i.jsx(f.nU,{value:"current",children:(0,i.jsxs)(d.Zb,{children:[(0,i.jsxs)(d.Ol,{children:[i.jsx(d.ll,{children:"Aktuelle & Kommende Schichten"}),i.jsx(d.SZ,{children:"Dienstpl\xe4ne von heute und zuk\xfcnftig"})]}),i.jsx(d.aY,{children:y.length>0?(0,i.jsxs)(l.iA,{children:[i.jsx(l.xD,{children:(0,i.jsxs)(l.SC,{children:[i.jsx(l.ss,{children:"Datum & Zeit"}),i.jsx(l.ss,{children:"Wachabteilung"}),i.jsx(l.ss,{children:"Besetzung"}),i.jsx(l.ss,{children:"Status"}),i.jsx(l.ss,{children:"Aktionen"})]})}),i.jsx(l.RM,{children:y.map(k)})]}):i.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Keine aktuellen Schichten vorhanden. Erstellen Sie die erste Schicht."})})]})}),i.jsx(f.nU,{value:"past",children:(0,i.jsxs)(d.Zb,{children:[(0,i.jsxs)(d.Ol,{children:[i.jsx(d.ll,{children:"Vergangene Schichten"}),i.jsx(d.SZ,{children:"Archiv aller abgeschlossenen Dienstpl\xe4ne"})]}),i.jsx(d.aY,{children:v.length>0?(0,i.jsxs)(l.iA,{children:[i.jsx(l.xD,{children:(0,i.jsxs)(l.SC,{children:[i.jsx(l.ss,{children:"Datum & Zeit"}),i.jsx(l.ss,{children:"Wachabteilung"}),i.jsx(l.ss,{children:"Besetzung"}),i.jsx(l.ss,{children:"Status"}),i.jsx(l.ss,{children:"Aktionen"})]})}),i.jsx(l.RM,{children:v.map(k)})]}):i.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Keine vergangenen Schichten vorhanden."})})]})})]})]})}},59558:(e,t,r)=>{"use strict";r.d(t,{C:()=>o});var i=r(19510);r(71159);var s=r(46145),n=r(40644);let a=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:t,...r}){return i.jsx("div",{className:(0,n.cn)(a({variant:t}),e),...r})}},75782:(e,t,r)=>{"use strict";r.d(t,{RM:()=>d,SC:()=>l,iA:()=>a,pj:()=>f,ss:()=>c,xD:()=>o});var i=r(19510),s=r(71159),n=r(40644);let a=s.forwardRef(({className:e,...t},r)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:r,className:(0,n.cn)("w-full caption-bottom text-sm",e),...t})}));a.displayName="Table";let o=s.forwardRef(({className:e,...t},r)=>i.jsx("thead",{ref:r,className:(0,n.cn)("[&_tr]:border-b",e),...t}));o.displayName="TableHeader";let d=s.forwardRef(({className:e,...t},r)=>i.jsx("tbody",{ref:r,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...t}));d.displayName="TableBody",s.forwardRef(({className:e,...t},r)=>i.jsx("tfoot",{ref:r,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let l=s.forwardRef(({className:e,...t},r)=>i.jsx("tr",{ref:r,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));l.displayName="TableRow";let c=s.forwardRef(({className:e,...t},r)=>i.jsx("th",{ref:r,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableHead";let f=s.forwardRef(({className:e,...t},r)=>i.jsx("td",{ref:r,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));f.displayName="TableCell",s.forwardRef(({className:e,...t},r)=>i.jsx("caption",{ref:r,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},94725:(e,t,r)=>{"use strict";r.d(t,{SP:()=>a,dr:()=>n,mQ:()=>s,nU:()=>o});var i=r(68570);let s=(0,i.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#Tabs`),n=(0,i.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsList`),a=(0,i.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsTrigger`),o=(0,i.createProxy)(String.raw`/Users/kamakaku/_desiqn/__wachboard/src/components/ui/tabs.tsx#TabsContent`)},42890:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createShift:()=>o,deleteShift:()=>f,duplicateShift:()=>c,updateShift:()=>d,updateShiftComplete:()=>l});var i=r(27745);r(26461);var s=r(71870),n=r(30207),a=r(74739);async function o(e){let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw console.error("User not authenticated"),Error("User not authenticated.");let i=e.get("date"),o=e.get("start_time"),d=e.get("end_time"),l=e.get("division_id");console.log("Form data:",{date:i,start_time:o,end_time:d,division_id:l,wachleitung_im_haus:"on"===e.get("wachleitung_im_haus")});let c=e.get("assignments"),f=e.get("copiedTrupps"),u=e.get("praktikantFlags");if(!i||!o||!d||!l)return console.error("Missing required fields:",{date:i,start_time:o,end_time:d,division_id:l}),(0,a.redirect)("/app/shifts/new?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.");let h={};try{h=c?JSON.parse(c):{},f&&JSON.parse(f),u&&JSON.parse(u)}catch(e){return console.error("Error parsing JSON data:",e),(0,a.redirect)("/app/shifts/new?error=Fehler beim Verarbeiten der Zuweisungen.")}let{data:p}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",r.id).single();if(!p||!["ADMIN","EDITOR"].includes(p.role))return(0,a.redirect)("/app/shifts/new?error=Keine Berechtigung.");let{data:g}=await t.from("divisions").select("id, station_id").eq("id",l).single();if(!g||g.station_id!==p.station_id)return(0,a.redirect)("/app/shifts/new?error=Ung\xfcltige Wachabteilung.");if("EDITOR"===p.role&&!(p.division_ids||[]).includes(l))return(0,a.redirect)("/app/shifts/new?error=Sie haben keinen Zugriff auf diese Division.");let m=e=>{let t=e.split(":");return`${t[0]}:${t[1]}`},b=`${i}T${m(o)}:00`,_=`${i}T${m(d)}:00`;if(m(d)<=m(o)){let e=new Date(`${i}T${m(d)}:00`);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];_=`${t}T${m(d)}:00`}console.log("Raw times:",{start_time:o,end_time:d}),console.log("Timestamps:",{starts_at:b,ends_at:_});let x=parseInt(o.split(":")[0]),{data:y,error:v}=await t.from("shifts").insert({station_id:p.station_id,division_id:l,starts_at:b,ends_at:_,label:x>=7&&x<19?"DAY":"NIGHT",status:"PUBLISHED"}).select().single();if(v)return(console.error("Error creating shift:",v),console.error("Error details:",JSON.stringify(v,null,2)),"23505"===v.code)?(0,a.redirect)(`/app/shifts/new?error=${encodeURIComponent("Es existiert bereits eine Schicht f\xfcr diese Wachabteilung zu dieser Startzeit.")}`):(0,a.redirect)(`/app/shifts/new?error=${encodeURIComponent("Fehler beim Erstellen der Schicht: "+v.message)}`);console.log("Shift created successfully:",y);let j=[];for(let[e,i]of Object.entries(h))for(let[s,n]of Object.entries(i))if(n){let{data:i}=await t.from("vehicle_configs").select("key").eq("id",e).single();i&&j.push({shift_id:y.id,vehicle_key:i.key,slot_key:s,person_id:n,updated_by:r.id})}if(j.length>0){let{error:e}=await t.from("assignments").insert(j);e&&console.error("Error creating assignments:",e)}(0,n.revalidatePath)("/app/shifts"),(0,a.redirect)("/app/shifts?success=Schicht erfolgreich erstellt.")}async function d(e){let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw console.error("User not authenticated"),Error("User not authenticated.");let i=e.get("shiftId"),o=e.get("date"),d=e.get("start_time"),l=e.get("end_time"),c=e.get("label")?.trim()??null,f=e.get("status")??"PUBLISHED";if(!i||!o||!d||!l)return(0,a.redirect)("/app/shifts?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.");let u=e=>{let t=e.split(":");return`${t[0]}:${t[1]??"00"}`},h=`${o}T${u(d)}:00`,p=`${o}T${u(l)}:00`;if(new Date(p)<=new Date(h)){let e=new Date(p);e.setDate(e.getDate()+1),p=e.toISOString().slice(0,19)}let{error:g}=await t.from("shifts").update({starts_at:h,ends_at:p,label:c,status:f}).eq("id",i);if(g)return console.error("Error updating shift:",g),(0,a.redirect)(`/app/shifts?error=${encodeURIComponent("Fehler beim Aktualisieren der Schicht.")}`);(0,n.revalidatePath)("/app/shifts"),(0,a.redirect)("/app/shifts?success=Schicht erfolgreich aktualisiert.")}async function l(e){console.log("====================================================="),console.log("updateShiftComplete called!"),console.log("FormData keys:",Array.from(e.keys())),console.log("=====================================================");let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw console.error("User not authenticated"),Error("User not authenticated.");let i=e.get("shift_id"),o=e.get("date"),d=e.get("start_time"),l=e.get("end_time"),c=e.get("division_id"),f="on"===e.get("wachleitung_im_haus");console.log("Basic form data:",{shift_id:i,date:o,start_time:d,end_time:l,division_id:c,wachleitung_im_haus:f});let u=e.get("assignments"),h=e.get("copiedTrupps"),p=e.get("praktikantFlags"),g=e.get("truppPraktikantFlags");if(!i||!o||!d||!l||!c)return(0,a.redirect)(`/app/shifts/${i}/edit?error=Alle erforderlichen Felder m\xfcssen ausgef\xfcllt werden.`);let m={},b={},_={},x={};console.log("Raw JSON from form:",{assignmentsJson:u,copiedTruppsJson:h,praktikantFlagsJson:p,truppPraktikantFlagsJson:g});try{m=u?JSON.parse(u):{},b=h?JSON.parse(h):{},_=p?JSON.parse(p):{},x=g?JSON.parse(g):{},console.log("Parsed assignments:",m),console.log("Parsed copiedTrupps:",b),console.log("Parsed praktikantFlags:",_),console.log("Parsed truppPraktikantFlags:",x)}catch(e){return console.error("Error parsing JSON data:",e),(0,a.redirect)(`/app/shifts/${i}/edit?error=Fehler beim Verarbeiten der Zuweisungen.`)}let{data:y}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",r.id).single();if(!y||!["ADMIN","EDITOR"].includes(y.role))return(0,a.redirect)(`/app/shifts/${i}/edit?error=Keine Berechtigung.`);let{data:v}=await t.from("shifts").select("id, station_id, division_id").eq("id",i).single();if(!v||v.station_id!==y.station_id)return(0,a.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===y.role&&!(y.division_ids||[]).includes(v.division_id))return(0,a.redirect)(`/app/shifts/${i}/edit?error=Sie haben keinen Zugriff auf diese Division.`);let{data:j}=await t.from("divisions").select("id, station_id").eq("id",c).single();if(!j||j.station_id!==y.station_id)return(0,a.redirect)(`/app/shifts/${i}/edit?error=Ung\xfcltige Wachabteilung.`);if("EDITOR"===y.role&&c!==v.division_id&&!(y.division_ids||[]).includes(c))return(0,a.redirect)(`/app/shifts/${i}/edit?error=Sie haben keinen Zugriff auf die neue Division.`);let w=e=>{let t=e.split(":");return`${t[0]}:${t[1]}`},k=`${o}T${w(d)}:00`,S=`${o}T${w(l)}:00`;if(w(l)<=w(d)){let e=new Date(`${o}T${w(l)}:00`);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];S=`${t}T${w(l)}:00`}console.log("Updating shift:",{shift_id:i,starts_at:k,ends_at:S});let $=parseInt(d.split(":")[0]),{error:N}=await t.from("shifts").update({division_id:c,starts_at:k,ends_at:S,label:$>=7&&$<19?"DAY":"NIGHT",wachleitung_im_haus:f}).eq("id",i);if(N)return console.error("Error updating shift:",N),(0,a.redirect)(`/app/shifts/${i}/edit?error=${encodeURIComponent("Fehler beim Aktualisieren der Schicht: "+N.message)}`);console.log("Shift updated successfully"),await t.from("assignments").delete().eq("shift_id",i);let T=[];console.log("Processing assignments. Total vehicles:",Object.keys(m).length),console.log("Processing copiedTrupps:",b),console.log("Processing praktikantFlags:",_);let{data:D}=await t.from("vehicle_configs").select("id, key, config").eq("station_id",y.station_id),P=new Map,I=new Map;D?.forEach(e=>{P.set(e.id,e.key),I.set(e.key,e.id)});let R=new Set;for(let[e,t]of Object.entries(b))for(let r of t)if(P.get(e)){let t=D?.find(e=>e.id===r.sourceVehicleId),i=t?.config?.trupps?.find(e=>e.key===r.sourceTruppKey);if(i?.slots)for(let t of i.slots){let i=`${r.targetTruppKey}:${t}`;R.add(`${e}:${i}`)}}for(let[e,t]of Object.entries(m)){let s=P.get(e);if(!s){console.error(`Vehicle not found for ID: ${e}`);continue}for(let[n,a]of(console.log(`Vehicle ${s} has ${Object.keys(t).length} slot assignments`),Object.entries(t))){let t=`${e}:${n}`;if(R.has(t)){console.log(`  - Skipping slot ${n} (belongs to copied trupp)`);continue}a&&(console.log(`  - Slot ${n}: Person ${a}`),T.push({shift_id:i,vehicle_key:s,slot_key:n,person_id:a,updated_by:r.id}))}}for(let[e,t]of Object.entries(b)){let s=P.get(e);if(!s){console.error(`Target vehicle not found for ID: ${e}`);continue}for(let e of t){let t=P.get(e.sourceVehicleId);if(!t){console.error(`Source vehicle not found for ID: ${e.sourceVehicleId}`);continue}for(let[n,a]of(console.log(`Processing copied trupp: ${e.sourceTruppKey} from ${t} to ${s} as ${e.targetTruppKey}`),Object.entries(m[e.sourceVehicleId]||{})))if("string"==typeof n&&n.startsWith(`${e.sourceTruppKey}:`)){let t=n.split(":")[1],o=`${e.targetTruppKey}:${t}`;a&&(console.log(`  - Copying ${n} to ${o} on ${s} with person ${a}`),T.push({shift_id:i,vehicle_key:s,slot_key:o,person_id:a,from_trupp_key:e.sourceTruppKey,updated_by:r.id}))}}}for(let[e,t]of Object.entries(_))if(t){let t=P.get(e);if(!t){console.error(`Vehicle not found for praktikant flag: ${e}`);continue}console.log(`Vehicle ${t} has praktikant flag set`),T.some(e=>e.vehicle_key===t&&("Praktikant"===e.slot_key||e.slot_key.toLowerCase().includes("praktikant")))||(T.push({shift_id:i,vehicle_key:t,slot_key:"Praktikant",person_id:null,placeholder_text:"Praktikant",updated_by:r.id}),console.log(`  - Added praktikant placeholder for ${t}`))}for(let[e,t]of Object.entries(x)){let s=P.get(e);if(!s){console.error(`Vehicle not found for trupp praktikant flags: ${e}`);continue}for(let[e,n]of Object.entries(t))if(n){console.log(`Trupp ${e} on vehicle ${s} has praktikant flag set`);let t=`${e}:Praktikant`;T.some(e=>e.vehicle_key===s&&e.slot_key===t)||(T.push({shift_id:i,vehicle_key:s,slot_key:t,person_id:null,placeholder_text:"Praktikant",updated_by:r.id}),console.log(`  - Added praktikant placeholder for trupp ${e} on ${s}`))}}if(console.log("Total assignment records to insert:",T.length),console.log("Assignment records:",T),T.length>0){let{error:e}=await t.from("assignments").insert(T);e?(console.error("Error creating assignments:",e),console.error("Assignment error details:",JSON.stringify(e,null,2))):console.log("Assignments created successfully!")}else console.log("No assignments to insert.");(0,n.revalidatePath)("/app/shifts"),(0,n.revalidatePath)(`/app/shifts/${i}/edit`),(0,a.redirect)("/app/shifts?success=Schicht erfolgreich aktualisiert.")}async function c(e){let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("User not authenticated.");let i=e.get("shiftId");if(!i)return(0,a.redirect)("/app/shifts?error=Keine Schicht-ID angegeben.");let{data:o}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",r.id).single();if(!o||!["ADMIN","EDITOR"].includes(o.role))return(0,a.redirect)("/app/shifts?error=Keine Berechtigung.");let{data:d,error:l}=await t.from("shifts").select(`
            *,
            assignments:assignments(vehicle_key, slot_key, person_id, from_trupp_key, placeholder_text)
        `).eq("id",i).eq("station_id",o.station_id).single();if(l||!d)return(0,a.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===o.role&&!(o.division_ids||[]).includes(d.division_id))return(0,a.redirect)("/app/shifts?error=Sie haben keinen Zugriff auf diese Division.");let c=new Date().toISOString().split("T")[0],f=new Date(d.starts_at),u=new Date(d.ends_at),h=`${String(f.getHours()).padStart(2,"0")}:${String(f.getMinutes()).padStart(2,"0")}`,p=`${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`,g=`${c}T${h}:00`,m=`${c}T${p}:00`;if(p<=h){let e=new Date(c);e.setDate(e.getDate()+1);let t=e.toISOString().split("T")[0];m=`${t}T${p}:00`}let{data:b,error:_}=await t.from("shifts").insert({station_id:d.station_id,division_id:d.division_id,starts_at:g,ends_at:m,label:d.label,status:"PUBLISHED",wachleitung_im_haus:d.wachleitung_im_haus}).select().single();if(_||!b)return(console.error("Error duplicating shift:",_),_?.code==="23505")?(0,a.redirect)(`/app/shifts?error=${encodeURIComponent("Es existiert bereits eine Schicht f\xfcr diese Wachabteilung zu dieser Startzeit.")}`):(0,a.redirect)(`/app/shifts?error=${encodeURIComponent("Fehler beim Duplizieren der Schicht.")}`);if(d.assignments&&d.assignments.length>0){let e=d.assignments.map(e=>({shift_id:b.id,vehicle_key:e.vehicle_key,slot_key:e.slot_key,person_id:e.person_id,from_trupp_key:e.from_trupp_key,placeholder_text:e.placeholder_text,updated_by:r.id})),{error:i}=await t.from("assignments").insert(e);i&&console.error("Error copying assignments:",i)}(0,n.revalidatePath)("/app/shifts"),(0,a.redirect)("/app/shifts?success=Schicht erfolgreich dupliziert.")}async function f(e){let t=(0,s.e)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("User not authenticated.");let i=e.get("shiftId");if(!i)return(0,a.redirect)("/app/shifts?error=Keine Schicht-ID angegeben.");let{data:o}=await t.from("memberships").select("station_id, role, division_ids").eq("user_id",r.id).single();if(!o||!["ADMIN","EDITOR"].includes(o.role))return(0,a.redirect)("/app/shifts?error=Keine Berechtigung.");let{data:d,error:l}=await t.from("shifts").select("id, station_id, division_id").eq("id",i).eq("station_id",o.station_id).single();if(l||!d)return(0,a.redirect)("/app/shifts?error=Schicht nicht gefunden.");if("EDITOR"===o.role&&!(o.division_ids||[]).includes(d.division_id))return(0,a.redirect)("/app/shifts?error=Sie haben keinen Zugriff auf diese Division.");await t.from("assignments").delete().eq("shift_id",i);let{error:c}=await t.from("shifts").delete().eq("id",i);if(c)return console.error("Error deleting shift:",c),(0,a.redirect)("/app/shifts?error=Fehler beim L\xf6schen der Schicht.");(0,n.revalidatePath)("/app/shifts"),(0,a.redirect)("/app/shifts?success=Schicht erfolgreich gel\xf6scht.")}(0,r(85723).h)([o,d,l,c,f]),(0,i.j)("3bb8a52f1e6d2cb5f65b2a70af5d9492fc3cff63",o),(0,i.j)("659765dc11ec3a57dc068050cea924c240e50f05",d),(0,i.j)("e04c74f5e7dd9916d243e6d59f930efd6e33927a",l),(0,i.j)("c0b7ffaff5ba9109e9722ecc16fbcb69f6dc93df",c),(0,i.j)("926a037a3539bd2b228bd1f6c613d88928e0c6ef",f)},71870:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var i=r(26407),s=r(53973);function n(){let e=(0,s.cookies)();return(0,i.createServerClient)("https://ghjfyjximndlrstwridq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoamZ5anhpbW5kbHJzdHdyaWRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NzczNjgsImV4cCI6MjA4MjU1MzM2OH0.kn8-ZKY2EYmIjm8H3bIiXsMeHHz7355LIdMrgBr4GpQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,i){try{e.set({name:t,value:r,...i})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}},28407:(e,t,r)=>{"use strict";r.d(t,{VY:()=>I,aV:()=>D,fC:()=>T,xz:()=>P});var i=r(17577),s=r(82561),n=r(93095),a=r(15594),o=r(9815),d=r(77335),l=r(17124),c=r(52067),f=r(88957),u=r(10326),h="Tabs",[p,g]=(0,n.b)(h,[a.Pc]),m=(0,a.Pc)(),[b,_]=p(h),x=i.forwardRef((e,t)=>{let{__scopeTabs:r,value:i,onValueChange:s,defaultValue:n,orientation:a="horizontal",dir:o,activationMode:p="automatic",...g}=e,m=(0,l.gm)(o),[_,x]=(0,c.T)({prop:i,onChange:s,defaultProp:n??"",caller:h});return(0,u.jsx)(b,{scope:r,baseId:(0,f.M)(),value:_,onValueChange:x,orientation:a,dir:m,activationMode:p,children:(0,u.jsx)(d.WV.div,{dir:m,"data-orientation":a,...g,ref:t})})});x.displayName=h;var y="TabsList",v=i.forwardRef((e,t)=>{let{__scopeTabs:r,loop:i=!0,...s}=e,n=_(y,r),o=m(r);return(0,u.jsx)(a.fC,{asChild:!0,...o,orientation:n.orientation,dir:n.dir,loop:i,children:(0,u.jsx)(d.WV.div,{role:"tablist","aria-orientation":n.orientation,...s,ref:t})})});v.displayName=y;var j="TabsTrigger",w=i.forwardRef((e,t)=>{let{__scopeTabs:r,value:i,disabled:n=!1,...o}=e,l=_(j,r),c=m(r),f=$(l.baseId,i),h=N(l.baseId,i),p=i===l.value;return(0,u.jsx)(a.ck,{asChild:!0,...c,focusable:!n,active:p,children:(0,u.jsx)(d.WV.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":h,"data-state":p?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:f,...o,ref:t,onMouseDown:(0,s.Mj)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(i)}),onKeyDown:(0,s.Mj)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(i)}),onFocus:(0,s.Mj)(e.onFocus,()=>{let e="manual"!==l.activationMode;p||n||!e||l.onValueChange(i)})})})});w.displayName=j;var k="TabsContent",S=i.forwardRef((e,t)=>{let{__scopeTabs:r,value:s,forceMount:n,children:a,...l}=e,c=_(k,r),f=$(c.baseId,s),h=N(c.baseId,s),p=s===c.value,g=i.useRef(p);return i.useEffect(()=>{let e=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,u.jsx)(o.z,{present:n||p,children:({present:r})=>(0,u.jsx)(d.WV.div,{"data-state":p?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":f,hidden:!r,id:h,tabIndex:0,...l,ref:t,style:{...e.style,animationDuration:g.current?"0s":void 0},children:r&&a})})});function $(e,t){return`${e}-trigger-${t}`}function N(e,t){return`${e}-content-${t}`}S.displayName=k;var T=x,D=v,P=w,I=S}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,374,702,582,559,369,4,744,863],()=>r(39292));module.exports=i})();