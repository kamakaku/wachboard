(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[88],{1448:function(e,t,s){Promise.resolve().then(s.bind(s,815))},815:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var l=s(7437),a=s(2265),r=s(8933),n=s(9820),i=s(9174),o=s(6246),c=s(3145);function d(e){let{params:t}=e,{stationId:s}=t,o=(0,r.e)(),[d,x]=(0,a.useState)([]),[h,m]=(0,a.useState)([]),[f,p]=(0,a.useState)(""),[g,v]=(0,a.useState)(null),[b,j]=(0,a.useState)(new Date),[N,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{y(!0);let e=setInterval(()=>j(new Date),1e3);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{let e=async()=>{let{data:e}=await o.from("stations").select("name, crest_url").eq("id",s).single();e&&(p(e.name),v(e.crest_url));let{data:t}=await o.from("vehicle_configs").select("*").eq("station_id",s).order("order");t&&m(t);let{data:l,error:a}=await o.from("shifts").select("*, division:divisions(*), assignments:assignments(*, people:people(*))").eq("station_id",s).gt("ends_at",new Date().toISOString()).order("starts_at",{ascending:!0}).limit(2);a?console.error("Error fetching shifts:",a):l&&(console.log("Fetched shifts count:",l.length),console.log("Fetched shifts details:",l.map(e=>{var t;return{id:e.id,division:null===(t=e.division)||void 0===t?void 0:t.name,starts_at:e.starts_at,ends_at:e.ends_at}})),console.log("Current time:",new Date().toISOString()),x(l))};e();let t=setInterval(()=>{e()},3e4),l=o.channel("realtime:shifts:".concat(s)).on("postgres_changes",{event:"*",schema:"public",table:"assignments"},t=>{console.log("Change received!",t),e()}).on("postgres_changes",{event:"*",schema:"public",table:"shifts"},t=>{console.log("Change received!",t),e()}).subscribe();return()=>{clearInterval(t),o.removeChannel(l)}},[s,o]);let w=d.find(e=>new Date(e.starts_at)<=b&&new Date(e.ends_at)>b),_=d.find(e=>new Date(e.starts_at)>b);return d.length>0&&N&&(console.log("Now:",b.toISOString()),console.log("Shifts:",d.map(e=>({id:e.id,division:e.division.name,starts_at:e.starts_at,ends_at:e.ends_at,isCurrent:new Date(e.starts_at)<=b&&new Date(e.ends_at)>b,isNext:new Date(e.starts_at)>b,startsInPast:new Date(e.starts_at)<=b,endsInFuture:new Date(e.ends_at)>b}))),console.log("Current shift:",w?"".concat(w.division.name," (").concat(w.starts_at," - ").concat(w.ends_at,")"):"none"),console.log("Next shift:",_?"".concat(_.division.name," (").concat(_.starts_at," - ").concat(_.ends_at,")"):"none")),(0,l.jsxs)("div",{className:"bg-white h-screen overflow-hidden flex flex-col p-2 font-sans",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2 flex-shrink-0 border-b border-gray-300 pb-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[g&&(0,l.jsx)(c.default,{src:g,alt:"".concat(f," Wappen"),width:60,height:60,className:"object-contain"}),(0,l.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:f||"Lade..."})]}),(0,l.jsx)("div",{className:"text-right",children:N?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{className:"text-lg font-bold text-gray-900 tabular-nums",children:[b.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"})," Uhr"]}),(0,l.jsx)("p",{className:"text-[10px] text-gray-600",children:b.toLocaleDateString("de-DE",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})})]}):(0,l.jsx)("div",{className:"h-8"})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 flex-1 overflow-hidden min-h-0",children:[w?(0,l.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,l.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-1.5 rounded flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(i.C,{className:"bg-white text-green-700 font-bold text-[9px] px-1.5 py-0.5",children:"AKTUELL"}),(0,l.jsx)("h2",{className:"text-base font-bold",children:w.division.name}),(0,l.jsxs)("p",{className:"text-[10px] opacity-90",children:[w.starts_at.split("T")[1].slice(0,5)," - ",w.ends_at.split("T")[1].slice(0,5)]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[w.wachleitung_im_haus&&(0,l.jsx)(i.C,{className:"bg-yellow-400 text-yellow-900 font-bold text-xs px-2 py-0.5",children:"WL im Haus"}),(()=>{let e=parseInt(w.starts_at.split("T")[1].slice(0,2));return e>=7&&e<19?(0,l.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,l.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})})()]})]})}),(0,l.jsx)("div",{className:"flex-1 flex flex-col gap-5 mt-1 overflow-y-auto",children:h.map(e=>(0,l.jsx)(u,{vehicle:e,shift:w},e.key))})]}):(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)(n.Zb,{className:"border-2 border-gray-300 bg-gray-50",children:(0,l.jsx)(n.aY,{className:"p-12 text-center",children:(0,l.jsx)("p",{className:"text-3xl text-gray-500 font-semibold",children:"Keine aktuelle Schicht"})})})}),_?(0,l.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-1.5 rounded flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(i.C,{className:"bg-white text-blue-700 font-bold text-[9px] px-1.5 py-0.5",children:"N\xc4CHSTE"}),(0,l.jsx)("h2",{className:"text-base font-bold",children:_.division.name}),(0,l.jsxs)("p",{className:"text-[10px] opacity-90",children:[_.starts_at.split("T")[1].slice(0,5)," - ",_.ends_at.split("T")[1].slice(0,5)]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[_.wachleitung_im_haus&&(0,l.jsx)(i.C,{className:"bg-yellow-400 text-yellow-900 font-bold text-xs px-2 py-0.5",children:"WL im Haus"}),(()=>{let e=parseInt(_.starts_at.split("T")[1].slice(0,2));return e>=7&&e<19?(0,l.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,l.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})})()]})]})}),(0,l.jsx)("div",{className:"flex-1 flex flex-col gap-5 mt-1 overflow-y-auto",children:h.map(e=>(0,l.jsx)(u,{vehicle:e,shift:_},e.key))})]}):(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)(n.Zb,{className:"border-2 border-gray-300 bg-gray-50",children:(0,l.jsx)(n.aY,{className:"p-12 text-center",children:(0,l.jsx)("p",{className:"text-3xl text-gray-500 font-semibold",children:"Keine n\xe4chste Schicht geplant"})})})})]})]})}function u(e){let{vehicle:t,shift:s}=e;t.config;let a=s.assignments,r=new Map,d=[];a.filter(e=>e.vehicle_key===t.key).forEach(e=>{var t,s,l,a,n;let i=null!==(s=e.people)&&void 0!==s?s:null,o=e.slot_key,c={key:o,label:o.includes(":")?o.split(":")[1]:o},u=null!==(l=o.includes("Trupp "))&&void 0!==l&&l,x=u&&o?o.split(":")[0]:null,h=null!==(a=null===(t=c.label)||void 0===t?void 0:t.toLowerCase().includes("praktikant"))&&void 0!==a&&a,m=null!==(n=e.from_trupp_key)&&void 0!==n?n:null,f={slot:c,assignment:e,person:i,isSpecial:"__notarzt__"===o||"__fuehrungsdienst__"===o,isTrupp:u,truppName:x,isPraktikant:h,fromTrupp:m};x?(r.has(x)||r.set(x,[]),r.get(x).push(f)):d.push(f)});let u=[];r.forEach((e,t)=>{let s=e.filter(e=>e.person||e.isPraktikant);s.length>0&&u.push({truppName:t,slots:s})}),d.length>0&&u.push({truppName:null,slots:d});let x=a.filter(e=>{var s,l;return e.vehicle_key===t.key&&((null===(s=e.slot_key)||void 0===s?void 0:s.toLowerCase().includes("praktikant"))||(null===(l=e.placeholder_text)||void 0===l?void 0:l.toLowerCase().includes("praktikant")))}).length;return(0,l.jsx)(n.Zb,{className:"border border-gray-200 bg-white",children:(0,l.jsxs)(n.aY,{className:"p-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[t.image_url&&(0,l.jsx)("div",{className:"w-20 h-16 overflow-hidden rounded border border-gray-200 flex-shrink-0",children:(0,l.jsx)(c.default,{src:t.image_url,alt:t.title,width:80,height:64,className:"w-full h-full object-contain"})}),(0,l.jsx)("h3",{className:"text-base font-bold text-gray-900 flex-1",children:t.title}),x>0&&(0,l.jsxs)(i.C,{className:"bg-green-500 text-white font-bold text-xs px-2 py-0.5",children:[x," PRAKTIKANT",x>1?"EN":""]})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-1",children:0===u.length?(0,l.jsx)("div",{className:"col-span-2 text-center py-4 text-gray-400 italic text-sm",children:"Keine Personen zugeordnet"}):u.map((e,t)=>{if(e.truppName){let t=e.slots.filter(e=>!e.isPraktikant),s=e.slots.filter(e=>e.isPraktikant),a=s.length>0;return(0,l.jsxs)("div",{className:"col-span-2 bg-blue-50 rounded-md p-1.5 flex items-center gap-2",children:[(0,l.jsx)("div",{className:"font-bold text-sm text-blue-700 whitespace-nowrap px-1 flex items-center gap-1",children:e.truppName}),(0,l.jsxs)("div",{className:"flex-1 grid ".concat(a?"grid-cols-7":"grid-cols-2"," gap-1 items-start"),children:[t.map(e=>{var t;let{slot:s,person:r,fromTrupp:n}=e;return(0,l.jsxs)("div",{className:"".concat(a?"col-span-3":""," bg-white p-1.5 rounded flex items-center gap-2 ").concat(n?"border border-purple-400":""),children:[(0,l.jsx)(o.q,{src:(null==r?void 0:r.photo_url)||void 0,name:(null==r?void 0:r.name)||void 0,size:40}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-bold text-[11px] text-gray-900 leading-tight break-words",children:null!==(t=null==r?void 0:r.name)&&void 0!==t?t:"---"}),(0,l.jsxs)("p",{className:"text-[9px] uppercase leading-tight text-blue-600 break-words",children:[s.label,n&&(0,l.jsxs)("span",{className:"text-purple-600",children:[" ← ",n]})]})]})]},s.key)}),s.map(e=>{let{slot:t}=e;return(0,l.jsx)("div",{className:"col-span-1 bg-green-500 text-white p-1.5 rounded flex items-center justify-center min-h-[3.2rem]",children:(0,l.jsx)("p",{className:"font-bold text-[9px] text-center leading-tight",children:"+ Praktikant"})},t.key)})]})]},e.truppName)}{let s=e.slots.filter(e=>!e.isPraktikant),a=e.slots.filter(e=>e.isPraktikant),r=a.length>0;return(0,l.jsxs)("div",{className:"col-span-2 grid ".concat(r?"grid-cols-7":"grid-cols-2"," gap-1 items-start"),children:[s.map(e=>{var t;let{slot:s,person:a,isSpecial:n,fromTrupp:i}=e,c=n?"bg-orange-50 border-l-4 border-orange-500":i?"bg-purple-50 border-l-2 border-purple-400":"bg-gray-50";return(0,l.jsxs)("div",{className:"".concat(r?"col-span-3":""," ").concat(c," p-1.5 rounded flex items-center gap-2 relative"),children:[n&&(0,l.jsx)("div",{className:"absolute top-0 right-0 bg-orange-500 text-white text-[8px] font-bold px-1.5 py-0.5 rounded-bl rounded-tr",children:"SPEZIAL"}),(0,l.jsx)(o.q,{src:(null==a?void 0:a.photo_url)||void 0,name:(null==a?void 0:a.name)||void 0,size:40}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-bold text-[11px] text-gray-900 leading-tight break-words",children:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"---"}),(0,l.jsxs)("p",{className:"text-[9px] uppercase leading-tight break-words ".concat(n?"text-orange-700 font-bold":i?"text-purple-700":"text-gray-500"),children:[s.label,i&&(0,l.jsxs)("span",{children:[" ← ",i]})]})]})]},s.key)}),a.map(e=>{let{slot:t}=e;return(0,l.jsx)("div",{className:"col-span-1 bg-green-500 text-white p-1.5 rounded flex items-center justify-center min-h-[3.2rem]",children:(0,l.jsx)("p",{className:"font-bold text-[9px] text-center leading-tight",children:"+ Praktikant"})},t.key)})]},"individual-".concat(t))}})})]})})}},6246:function(e,t,s){"use strict";s.d(t,{q:function(){return n}});var l=s(7437),a=s(3145),r=s(3448);function n(e){let{src:t,name:s,size:n=36,className:i}=e,o=s?s.split(" ").filter(Boolean).map(e=>e[0]).slice(0,2).join("").toUpperCase():"";return(0,l.jsx)("div",{className:(0,r.cn)("relative overflow-hidden rounded-full bg-muted text-muted-foreground/70 flex items-center justify-center border border-border flex-shrink-0",i),style:{width:n,height:n},children:t?(0,l.jsx)(a.default,{src:t,alt:null!=s?s:"Avatar",width:n,height:n,className:"object-cover w-full h-full",unoptimized:!0}):(0,l.jsx)("span",{style:{fontSize:.4*n},className:"font-semibold",children:o||"?"})})}},9174:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var l=s(7437);s(2265);var a=s(535),r=s(3448);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...a}=e;return(0,l.jsx)("div",{className:(0,r.cn)(n({variant:s}),t),...a})}},9820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var l=s(7437),a=s(2265),r=s(3448);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},8933:function(e,t,s){"use strict";s.d(t,{e:function(){return a}});var l=s(1259);function a(){return(0,l.createBrowserClient)("https://ghjfyjximndlrstwridq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoamZ5anhpbW5kbHJzdHdyaWRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NzczNjgsImV4cCI6MjA4MjU1MzM2OH0.kn8-ZKY2EYmIjm8H3bIiXsMeHHz7355LIdMrgBr4GpQ")}},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return r}});var l=s(1994),a=s(3335);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,l.W)(t))}},535:function(e,t,s){"use strict";s.d(t,{j:function(){return n}});var l=s(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=l.W,n=(e,t)=>s=>{var l;if((null==t?void 0:t.variants)==null)return r(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(e=>{let t=null==s?void 0:s[e],l=null==i?void 0:i[e];if(null===t)return null;let r=a(t)||a(l);return n[e][r]}),c=s&&Object.entries(s).reduce((e,t)=>{let[s,l]=t;return void 0===l||(e[s]=l),e},{});return r(e,o,null==t?void 0:null===(l=t.compoundVariants)||void 0===l?void 0:l.reduce((e,t)=>{let{class:s,className:l,...a}=t;return Object.entries(a).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...i,...c}[t]):({...i,...c})[t]===s})?[...e,s,l]:e},[]),null==s?void 0:s.class,null==s?void 0:s.className)}}},function(e){e.O(0,[137,145,172,971,117,744],function(){return e(e.s=1448)}),_N_E=e.O()}]);